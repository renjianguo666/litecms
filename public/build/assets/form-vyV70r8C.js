import{h as x,A as m,C as o,b as a,F as S,S as w,a0 as M,e as j}from"./vendor-ui-EoCh-MHn.js";import{S as C,ah as k,ai as E,aj as P,H as z,q as L}from"./main-B6UhN7Jf.js";import{r as R}from"./rotate-ccw-2iP1iOhh.js";import{s as T}from"./save-DLjXE32a.js";var O=m('<div class="text-center text-sm text-muted-foreground py-8">暂无可用权限'),B=m("<div class=space-y-4>"),U=m('<div class="rounded-lg border bg-card"><div class="flex items-center justify-between border-b px-4 py-3"><div class="flex items-center gap-3"><span class=font-medium></span><span class="text-xs text-muted-foreground">(<!>/<!>)</span></div></div><div class="grid grid-cols-2 gap-2 p-4 sm:grid-cols-3 lg:grid-cols-4">'),V=m('<label class="flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors hover:bg-muted"><span>');const q={articles:"文章管理",taxonomies:"分类管理",accounts:"用户管理",settings:"系统设置",themes:"模板管理",media:"媒体管理"},D={view:"查看",create:"创建",update:"编辑",delete:"删除"};function y(t){const[i,n]=t.split(":");if(!n)return{module:"other",action:"",target:t};const s=n.split("_"),l=s[0],d=s.slice(1).join("_");return{module:i,action:l,target:d}}function G(t){if(t.description)return t.description;const{action:i,target:n}=y(t.name);return`${D[i]||i}${n}`}function H(t){const i={};for(const n of t){const{module:s}=y(n.name);i[s]||(i[s]={module:s,moduleName:q[s]||s,permissions:[]}),i[s].permissions.push({id:n.id,name:n.name,label:G(n)})}return Object.values(i).sort((n,s)=>n.moduleName.localeCompare(s.moduleName))}function W(t){const i=x(()=>H(t.permissions)),n=x(()=>new Set(t.value)),s=r=>{const e=new Set(t.value);e.has(r)?e.delete(r):e.add(r),t.onChange(Array.from(e))},l=r=>{const e=new Set(t.value),u=r.permissions.map(c=>c.id);u.every(c=>e.has(c))?u.forEach(c=>e.delete(c)):u.forEach(c=>e.add(c)),t.onChange(Array.from(e))},d=r=>r.permissions.every(e=>n().has(e.id));return(()=>{var r=B();return o(r,a(S,{get each(){return i()},children:e=>(()=>{var u=U(),h=u.firstChild,c=h.firstChild,f=c.firstChild,b=f.nextSibling,F=b.firstChild,_=F.nextSibling,N=_.nextSibling,v=N.nextSibling;v.nextSibling;var A=h.nextSibling;return o(c,a(C,{get checked(){return d(e)},onChange:()=>l(e)}),f),o(f,()=>e.moduleName),o(b,()=>e.permissions.filter(g=>n().has(g.id)).length,_),o(b,()=>e.permissions.length,v),o(A,a(S,{get each(){return e.permissions},children:g=>(()=>{var p=V(),$=p.firstChild;return o(p,a(C,{get checked(){return n().has(g.id)},onChange:()=>s(g.id)}),$),o($,()=>g.label),p})()})),u})()}),null),o(r,a(w,{get when(){return i().length===0},get children(){return O()}}),null),r})()}var I=m('<div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-lg font-semibold mb-4">角色信息</h2><div class="grid grid-cols-1 gap-4">'),J=m('<div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-lg font-semibold mb-4">权限设置'),K=m('<div class="flex justify-end gap-3 pt-4">'),Q=m('<div class="flex items-center justify-center py-8 text-muted-foreground">加载权限列表...');function te(t){const[i]=M(async()=>(await k.list({page_size:100})).items??[]),n=t.mode==="create"?E:P,s=z(()=>({defaultValues:t.defaultValues,validators:{onMount:n,onChange:n},onSubmit:async({value:l})=>{t.mode==="create"?await t.onSubmit(l):await t.onSubmit(l)}}));return a(s.Form,{class:"max-w-4xl mx-auto space-y-6",get children(){return[(()=>{var l=I(),d=l.firstChild,r=d.firstChild,e=r.nextSibling;return o(e,a(s.StringField,{name:"name",label:"角色名称",placeholder:"请输入角色名称"}),null),o(e,a(s.TextareaField,{name:"description",label:"角色描述",placeholder:"请输入角色描述",rows:3}),null),l})(),(()=>{var l=J(),d=l.firstChild;return d.firstChild,o(d,a(w,{get when(){return!i.loading},get fallback(){return(()=>{var r=Q(),e=r.firstChild;return o(r,a(L,{class:"size-5 animate-spin mr-2"}),e),r})()},get children(){return a(s.Field,{name:"permissions",children:r=>a(W,{get permissions(){return i()??[]},get value(){return r().state.value??[]},onChange:e=>r().handleChange(e)})})}}),null),l})(),(()=>{var l=K();return o(l,a(s.ResetButton,{class:"gap-2",get children(){return[a(R,{class:"size-4"}),"重置"]}}),null),o(l,a(s.SubmitButton,{class:"gap-2",get children(){return[a(T,{class:"size-4"}),j(()=>t.submitText??"保存")]}}),null),l})()]}})}export{te as R};
