import{d as f,a0 as A,A as s,C as r,b as e,S as m,F as q,m as ce,e as v}from"./vendor-ui-EoCh-MHn.js";import{y as T,n as de,B as d,T as oe,e as ue,f as ge,q as z,D as Q,h as U,i as E,j as G,Q as he,R as me,S as J,l as L,k as pe,m as fe,t as _,p as ve,A as N,U as xe,d as V,C as W,a as X,b as Y,c as be}from"./main-8-Lyl6Ls.js";import{B as k}from"./badge-CMo7waT2.js";import{T as Z,a as ee,b as S,c as $,d as te,e as y}from"./table-BEZ5gYHa.js";import{p as _e,t as $e}from"./trash-2-DFLhenRk.js";import"./vendor-form-BYywqLDt.js";import"./vendor-editor-B9FEBeCH.js";var ye=s('<div class="rounded-lg border border-border overflow-hidden">'),we=s('<div class="relative mb-4">'),Ce=s('<div class="min-h-[300px] max-h-[400px] overflow-y-auto border border-border rounded-lg">'),Se=s('<div class="text-sm text-muted-foreground">已选择 <!> 篇文章'),Te=s('<div class=space-y-4><div class="flex items-center justify-between"><div class="text-sm text-muted-foreground">共 <!> 篇文章'),ze=s('<div class="flex justify-center py-8">'),ke=s('<div class="text-center py-12 text-muted-foreground"><p class="text-lg mb-2">暂无文章</p><p class=text-sm>点击「添加文章」将文章加入此标签'),re=s("<span class=font-medium>"),De=s('<div class="flex items-center justify-center h-[300px] text-muted-foreground">请输入关键词搜索文章'),Ie=s('<div class="flex items-center justify-center h-[300px]">'),Ae=s('<div class="flex items-center justify-center h-[300px] text-muted-foreground">未找到相关文章');function je(o){const[u,g]=f(!1),[x,c]=f(""),[a,w]=f(new Set),[j,R]=f(!1),[D,I]=f(null),[B,H]=f(!1),[C,{refetch:F}]=A(()=>o.tagId,t=>T.listContents(t)),[b]=A(()=>u()?x():null,async t=>!t||t.length<2?null:(await de.list({search:t,page_size:20})).items),ne=async()=>{const t=D();if(t){H(!0);try{await T.removeContent(o.tagId,t.contentId),_.success("移除成功"),I(null),F()}catch{_.error("移除失败")}finally{H(!1)}}},M=t=>{const i=new Set(a());i.has(t)?i.delete(t):i.add(t),w(i)},le=t=>{w(t?new Set(b()?.map(i=>i.id)??[]):new Set)},se=async()=>{const t=Array.from(a());if(t.length===0){_.error("请选择要添加的文章");return}R(!0);try{const i=await T.addContents(o.tagId,t);_.success(`成功添加 ${i.added} 篇文章`),P(),F()}catch{_.error("添加失败")}finally{R(!1)}},P=()=>{g(!1),w(new Set),c("")},ae=t=>{switch(t){case"published":return e(k,{class:"bg-green-500/10 text-green-600 border-green-500/20 dark:text-green-400",children:"已发布"});case"draft":return e(k,{class:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20 dark:text-yellow-400",children:"草稿"});default:return e(k,{variant:"secondary",children:"已归档"})}};return(()=>{var t=Te(),i=t.firstChild,K=i.firstChild,ie=K.firstChild,O=ie.nextSibling;return O.nextSibling,r(K,()=>C()?.contents?.length??0,O),r(i,e(d,{size:"sm",onClick:()=>g(!0),get children(){return[e(_e,{class:"size-4"}),"添加文章"]}}),null),r(t,e(m,{get when(){return!C.loading},get fallback(){return(()=>{var n=ze();return r(n,e(z,{class:"size-6 animate-spin text-primary"})),n})()},get children(){return e(m,{get when(){return C()?.contents?.length},get fallback(){return ke()},get children(){var n=ye();return r(n,e(Z,{get children(){return[e(ee,{class:"bg-muted/50",get children(){return e(S,{class:"hover:bg-muted/50",get children(){return[e($,{class:"px-4 font-semibold",children:"标题"}),e($,{class:"px-4 font-semibold w-20",children:"操作"})]}})}}),e(te,{get children(){return e(q,{get each(){return C()?.contents},children:(l,p)=>e(S,{get class(){return p()%2===1?"bg-muted/30":""},get children(){return[e(y,{class:"px-4 py-3",get children(){var h=re();return r(h,()=>l.title),h}}),e(y,{class:"px-4 py-3",get children(){return e(oe,{get children(){return[e(ue,{as:h=>e(d,ce({variant:"ghost",size:"icon-sm",class:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>I({contentId:l.content_id,title:l.title})},h,{get children(){return e($e,{class:"size-3.5"})}}))}),e(ge,{children:"移除"})]}})}})]}})})}})]}})),n}})}}),null),r(t,e(Q,{get open(){return u()},onOpenChange:g,get children(){return e(U,{class:"max-w-2xl",get children(){return[e(E,{get children(){return e(G,{children:"添加文章到标签"})}}),(()=>{var n=we();return r(n,e(he,{class:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground pointer-events-none"}),null),r(n,e(me,{type:"text",placeholder:"输入关键词搜索文章（至少2个字符）",class:"pl-10",get value(){return x()},onInput:l=>c(l.currentTarget.value)}),null),n})(),(()=>{var n=Ce();return r(n,e(m,{get when(){return x().length>=2},get fallback(){return De()},get children(){return e(m,{get when(){return!b.loading},get fallback(){return(()=>{var l=Ie();return r(l,e(z,{class:"size-6 animate-spin text-primary"})),l})()},get children(){return e(m,{get when(){return b()?.length},get fallback(){return Ae()},get children(){return e(Z,{get children(){return[e(ee,{class:"bg-muted/50",get children(){return e(S,{class:"hover:bg-muted/50",get children(){return[e($,{class:"px-4 font-semibold w-8",get children(){return e(J,{get checked(){return v(()=>b()?.length===a().size)()&&a().size>0},onChange:le})}}),e($,{class:"px-4 font-semibold",children:"标题"}),e($,{class:"px-4 font-semibold w-24",children:"状态"})]}})}}),e(te,{get children(){return e(q,{get each(){return b()},children:(l,p)=>e(S,{get class(){return`cursor-pointer ${p()%2===1?"bg-muted/30":""}`},onClick:()=>M(l.id),get children(){return[e(y,{class:"px-4 py-3",get children(){return e(J,{get checked(){return a().has(l.id)},onChange:()=>M(l.id)})}}),e(y,{class:"px-4 py-3",get children(){var h=re();return r(h,()=>l.title),h}}),e(y,{class:"px-4 py-3",get children(){return ae(l.status)}})]}})})}})]}})}})}})}})),n})(),e(m,{get when(){return a().size>0},get children(){var n=Se(),l=n.firstChild,p=l.nextSibling;return p.nextSibling,r(n,()=>a().size,p),n}}),e(L,{get children(){return[e(d,{variant:"outline",onClick:P,children:"取消"}),e(d,{get disabled(){return a().size===0||j()},onClick:se,get children(){return[v(()=>v(()=>!!j())()&&e(z,{class:"size-4 animate-spin"})),"添加 ",v(()=>a().size)," 篇文章"]}})]}})]}})}}),null),r(t,e(Q,{get open(){return D()!==null},onOpenChange:n=>!n&&I(null),get children(){return e(U,{get children(){return[e(E,{get children(){return[e(G,{children:"移除文章"}),e(pe,{get children(){return["确定要从标签中移除「",v(()=>D()?.title),"」吗？"]}})]}}),e(L,{get children(){return[e(fe,{as:d,variant:"outline",children:"取消"}),e(d,{variant:"destructive",onClick:ne,get disabled(){return B()},get children(){return B()?"移除中...":"确认移除"}})]}})]}})}}),null),t})()}var Re=s('<div class="flex items-start justify-between"><div class=space-y-1>'),Be=s('<div class="mx-auto max-w-4xl space-y-6"><div>'),He=s('<div class="flex min-h-[400px] items-center justify-center">');function Ue(){const o=ve(),[u]=A(()=>o.id,T.get);return(()=>{var g=Be(),x=g.firstChild;return r(x,e(d,{as:N,href:"/tags",variant:"ghost",size:"sm",get children(){return[e(xe,{class:"mr-2 h-4 w-4"}),"返回标签列表"]}})),r(g,e(m,{get when(){return v(()=>!u.loading)()&&u()},get fallback(){return(()=>{var c=He();return r(c,e(z,{class:"h-8 w-8 animate-spin text-muted-foreground"})),c})()},get children(){return[e(V,{get children(){return e(W,{get children(){var c=Re(),a=c.firstChild;return r(a,e(X,{get children(){return u().name}}),null),r(a,e(Y,{get children(){return e(k,{variant:"secondary",class:"font-mono text-xs",get children(){return u().slug}})}}),null),r(c,e(d,{as:N,get href(){return`/tags/${o.id}`},variant:"outline",size:"sm",children:"编辑标签"}),null),c}})}}),e(V,{get children(){return[e(W,{get children(){return[e(X,{children:"内容管理"}),e(Y,{children:"管理与此标签关联的内容"})]}}),e(be,{get children(){return e(je,{get tagId(){return o.id}})}})]}})]}}),null),g})()}export{Ue as default};
