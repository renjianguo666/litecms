import{z as le,s as ne,h as B,A as h,C as l,b as t,k as z,U as C,S as f,Q as ae,F as Z,V as M,e as K,d as re,a0 as O}from"./vendor-ui-EoCh-MHn.js";import{r as S,s as ie,v as oe,w as de,x as ce,y as ue,z as he,E as ge,F as me,G as pe,H as fe,q as ve,J as be}from"./main-dmt7HXak.js";import{f as xe,T as _e}from"./tree-list-BvwAbnq5.js";import{c as $e}from"./chevron-right-2lgA9xTq.js";import{r as we}from"./rotate-ccw-DKhTP1vy.js";import{s as ye}from"./save-ceHAUwVX.js";var Ce=h("<button type=button>清空"),Se=h('<div class="mt-1.5 flex flex-wrap gap-1">'),ke=h('<div class="mt-1 text-xs text-muted-foreground">未选择'),Le=h('<div data-slot=tree-list-multi><div class="px-3 py-2 border-b bg-muted/50 shrink-0"><div class="flex items-center justify-between"><span class="text-sm font-medium"></span><div class="flex gap-1"><button type=button>全部</button></div></div></div><div class="flex-1 overflow-y-auto py-1 min-h-0">'),Fe=h('<span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded bg-primary text-primary-foreground">'),ze=h('<div class="py-8 text-center text-sm text-muted-foreground">'),Ee=h("<button type=button>"),Ie=h("<span>"),Te=h('<span class="text-xs text-muted-foreground/60 mr-2">(当前)'),Ae=h('<div><div class="flex h-full shrink-0"><div class="relative h-full"style=width:18px><div class="absolute top-0"style=left:9px></div><div class=absolute style=left:9px;top:50%;width:9px></div></div></div><div></div><span>'),Ue=h('<div class="absolute top-0 h-full"style=left:9px>'),Ne=h('<div class="relative h-full"style=width:18px>'),Pe=h('<span class="w-4 shrink-0">');function Ve(v,o){const k=()=>o?.(),$=B(()=>{const e=v();return e.map((n,i)=>{const d=e[i+1],g=d?d.depth>n.depth:!1;return{...n,has_children:g}})}),E=()=>new Set($().filter(e=>e.has_children).map(e=>e.id)),[L,w]=re(E()),[c,I]=re(!0),T=()=>{c()?(w(new Set),I(!1)):(w(E()),I(!0))},N=(e,n)=>{n.stopPropagation();const i=new Set(L());i.has(e)?i.delete(e):i.add(e),w(i)},A=e=>{const n=$(),i=n[e];if(i.depth===0)return!0;let d=i.depth-1;for(let g=e-1;g>=0&&d>=0;g--){const m=n[g];if(m.depth===d){if(!L().has(m.id))return!1;d--}}return!0},U=(e,n)=>{const i=$();for(let d=e+1;d<i.length;d++){if(i[d].depth===n)return!1;if(i[d].depth<n)return!0}return!0};return{processedNodes:$,expanded:L,allExpanded:c,toggleAll:T,toggleExpand:N,isVisible:A,isLastInLevel:U,getTreeLines:e=>{const n=$(),i=n[e],d=[];for(let g=0;g<i.depth;g++){let m=-1;for(let y=e-1;y>=0;y--)if(n[y].depth===g){m=y;break}if(m===-1){d.push(!1);continue}d.push(!U(m,g))}return d},isDisabled:e=>e===k()}}function je(v){const[o]=ne(v,["nodes","value","onChange","class","title","placeholder","disabledId","showIcon"]),{processedNodes:k,expanded:$,allExpanded:E,toggleAll:L,toggleExpand:w,isVisible:c,isLastInLevel:I,getTreeLines:T,isDisabled:N}=Ve(()=>o.nodes,()=>o.disabledId),A=B(()=>new Set(o.value)),U=e=>{const n=new Set(o.value);n.has(e)?n.delete(e):n.add(e),o.onChange(Array.from(n))},r=()=>{o.onChange([])},u=B(()=>{const e=[],n=A();for(const i of o.nodes)n.has(i.id)&&e.push(i.name);return e});return(()=>{var e=Le(),n=e.firstChild,i=n.firstChild,d=i.firstChild,g=d.nextSibling,m=g.firstChild,y=m.firstChild,H=n.nextSibling;return l(d,()=>o.title??"选择节点"),l(g,t(f,{get when(){return o.value.length>0},get children(){var s=Ce();return s.$$click=r,z(()=>C(s,S("inline-flex items-center px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors"))),s}}),m),ae(m,"click",L,!0),l(m,()=>E()?"收起":"展开",y),l(n,t(f,{get when(){return o.value.length>0},get children(){var s=Se();return l(s,t(Z,{get each(){return u()},children:b=>(()=>{var p=Fe();return l(p,b),p})()})),s}}),null),l(n,t(f,{get when(){return o.value.length===0},get children(){return ke()}}),null),l(H,t(f,{get when(){return k().length>0},get fallback(){return(()=>{var s=ze();return l(s,()=>o.placeholder??"暂无数据"),s})()},get children(){return t(Z,{get each(){return k()},children:(s,b)=>{const p=()=>N(s.id),x=()=>A().has(s.id),D=()=>I(b(),s.depth),W=()=>T(b()),P=()=>$().has(s.id),V=()=>x()?"1px solid hsl(var(--primary-foreground) / 0.6)":"1px solid hsl(var(--muted-foreground) / 0.3)";return t(f,{get when(){return c(b())},get children(){var _=Ae(),q=_.firstChild,X=q.firstChild,G=X.firstChild,se=G.nextSibling,R=q.nextSibling,J=R.nextSibling;return _.$$click=()=>!p()&&U(s.id),l(q,t(Z,{get each(){return W()},children:a=>(()=>{var F=Ne();return l(F,t(f,{when:a,get children(){var j=Ue();return z(Q=>M(j,"border-left",V())),j}})),F})()}),X),l(_,t(f,{get when(){return s.has_children},get fallback(){return Pe()},get children(){var a=Ee();return a.$$click=F=>w(s.id,F),l(a,t(f,{get when(){return P()},get fallback(){return t($e,{class:"size-3.5"})},get children(){return t(ie,{class:"size-3.5"})}})),z(()=>C(a,S("w-4 h-4 flex items-center justify-center shrink-0 rounded","transition-transform duration-200",x()?"text-primary-foreground/80 hover:text-primary-foreground":"text-muted-foreground hover:text-foreground"))),a}}),R),l(R,t(f,{get when(){return x()},get children(){return t(oe,{class:"size-3"})}})),l(_,t(f,{get when(){return o.showIcon!==!1},get children(){var a=Ie();return l(a,t(f,{get when(){return K(()=>!!s.has_children)()&&P()},get fallback(){return t(xe,{class:"size-4"})},get children(){return t(de,{class:"size-4"})}})),z(()=>C(a,S("ml-1 shrink-0",x()?"text-primary-foreground/80":"text-amber-500 dark:text-amber-400"))),a}}),J),l(J,()=>s.name),l(_,t(f,{get when(){return p()},get children(){return Te()}}),null),z(a=>{var F=S("group flex items-center h-7 mx-1 select-none rounded-sm","transition-colors duration-150",p()&&"opacity-50 cursor-not-allowed",!p()&&x()&&"bg-primary text-primary-foreground cursor-pointer",!p()&&!x()&&"hover:bg-accent hover:text-accent-foreground cursor-pointer"),j=D()?"50%":"100%",Q=V(),Y=V(),ee=S("w-4 h-4 flex items-center justify-center shrink-0 rounded border",x()?"bg-primary-foreground/20 border-primary-foreground/40":"border-muted-foreground/30 group-hover:border-muted-foreground/50"),te=S("text-sm ml-1.5 truncate pr-2",x()&&"font-medium");return F!==a.e&&C(_,a.e=F),j!==a.t&&M(G,"height",a.t=j),Q!==a.a&&M(G,"border-left",a.a=Q),Y!==a.o&&M(se,"border-top",a.o=Y),ee!==a.i&&C(R,a.i=ee),te!==a.n&&C(J,a.n=te),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),_}})}})}})),z(s=>{var b=S("flex flex-col rounded-lg border bg-card text-card-foreground overflow-hidden",o.class),p=S("inline-flex items-center gap-1 px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors");return b!==s.e&&C(e,s.e=b),p!==s.t&&C(m,s.t=p),s},{e:void 0,t:void 0}),e})()}le(["click"]);var De=h('<div class="lg:mr-68 space-y-4"><div class="bg-card rounded-lg border border-border shadow-sm"><div class="p-5 space-y-4"></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">摘要与封面</h2><div class="grid grid-cols-1 gap-4"></div></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">推送至</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div></div><div class="flex items-center justify-between pt-2"><div class="flex gap-3">'),Re=h('<aside class="hidden lg:block fixed right-6.5 top-20 bottom-4 w-64">'),Me=h('<div class="flex items-center gap-2"><label class="text-sm font-medium whitespace-nowrap">发布时间</label><input type=datetime-local class="h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">'),Oe=h('<div class="h-full border border-border rounded-lg bg-card flex items-center justify-center">');function Qe(v){const o=crypto.randomUUID(),[k]=O(async()=>(await ce.list({page_size:100})).items??[]),[$]=O(async()=>(await ue.list({page_size:100})).items??[]),[E]=O(async()=>(await he.list({page_size:100})).items??[]),[L]=O(async()=>(await ge.list({page_size:100})).items??[]),w=v.mode==="create"?me:pe,c=fe(()=>({defaultValues:v.defaultValues,validators:{onMount:w,onChange:w},onSubmit:async({value:r})=>{v.mode==="create"?await v.onSubmit({...r,upload_token:o}):await v.onSubmit({...r,upload_token:o})}})),I=async r=>(await be.upload(r,o)).url,T=B(()=>{const r=k()??[];if(r.length===0)return[];const u=new Set(r.map(e=>e.parent_id).filter(e=>e!==null));return r.map(e=>({id:e.id,name:e.name,parent_id:e.parent_id??null,depth:e.depth,has_children:u.has(e.id)}))}),N=()=>($()??[]).map(r=>({label:r.name,value:r.id})),A=()=>(E()??[]).map(r=>({label:r.name,value:r.id})),U=()=>(L()??[]).map(r=>({label:r.name,value:r.id}));return t(c.Form,{class:"relative",get children(){return[(()=>{var r=De(),u=r.firstChild,e=u.firstChild,n=u.nextSibling,i=n.firstChild,d=i.firstChild,g=d.nextSibling,m=n.nextSibling,y=m.firstChild,H=y.firstChild,s=H.nextSibling,b=m.nextSibling,p=b.firstChild;return l(e,t(c.StringField,{name:"title",placeholder:"请输入文章标题"}),null),l(e,t(c.EditorField,{name:"content",label:"文章内容",placeholder:"请输入文章内容...",minHeight:"400px",showWordCount:!0,onImageUpload:I}),null),l(g,t(c.TextareaField,{name:"description",label:"文章描述",placeholder:"简短描述文章内容（可选）",rows:3}),null),l(g,t(c.StringField,{name:"cover_url",label:"封面图片",placeholder:"请输入封面图片URL（可选）"}),null),l(s,t(c.ComboboxField,{name:"tag_ids",label:"标签",get options(){return N()},placeholder:"选择标签...",searchPlaceholder:"搜索标签..."}),null),l(s,t(c.ComboboxField,{name:"special_ids",label:"专题",get options(){return A()},placeholder:"选择专题...",searchPlaceholder:"搜索专题..."}),null),l(s,t(c.ComboboxField,{name:"feature_ids",label:"推荐位",get options(){return U()},placeholder:"选择推荐位...",searchPlaceholder:"搜索推荐位..."}),null),l(b,t(c.AppField,{name:"published_at",children:x=>(()=>{var D=Me(),W=D.firstChild,P=W.nextSibling;return P.$$input=V=>{const _=V.currentTarget.value;x().handleChange(_?`${_}:00Z`:null)},z(()=>P.value=x().state.value?.slice(0,16)??""),D})()}),p),l(p,t(c.ResetButton,{class:"gap-2",get children(){return[t(we,{class:"size-4"}),"重置"]}}),null),l(p,t(c.SubmitButton,{class:"gap-2",get children(){return[t(ye,{class:"size-4"}),K(()=>v.submitText??"发布文章")]}}),null),r})(),(()=>{var r=Re();return l(r,t(f,{get when(){return!k.loading},get fallback(){return(()=>{var u=Oe();return l(u,t(ve,{class:"size-6 animate-spin text-muted-foreground"})),u})()},get children(){return K(()=>v.mode==="create")()?t(c.AppField,{name:"category_ids",mode:"array",children:u=>t(je,{get nodes(){return T()},get value(){return u().state.value??[]},onChange:e=>u().handleChange(e),title:"选择栏目",class:"h-full shadow-sm"})}):t(c.AppField,{name:"category_id",children:u=>t(_e,{get nodes(){return T()},get value(){return u().state.value??""},onChange:e=>u().handleChange(e),title:"选择栏目",class:"h-full shadow-sm",allowEmpty:!1})})}})),r})()]}})}le(["input"]);export{Qe as A};
