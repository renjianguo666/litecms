import{d as wt,o as it,e as _t,f as vt,a as At,b as D,m as Y,s as Pt,g as gt,u as pt}from"./vendor-ui-EoCh-MHn.js";const N=new WeakMap,j=new WeakMap,Z={current:[]};let lt=!1,W=0;const U=new Set,G=new Map;function Lt(r){const i=Array.from(r).sort((e,t)=>e instanceof L&&e.options.deps.includes(t)?1:t instanceof L&&t.options.deps.includes(e)?-1:0);for(const e of i){if(Z.current.includes(e))continue;Z.current.push(e),e.recompute();const t=j.get(e);if(t)for(const s of t){const n=N.get(s);n&&Lt(n)}}}function $t(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function Bt(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function Tt(r){if(W>0&&!G.has(r)&&G.set(r,r.prevState),U.add(r),!(W>0)&&!lt)try{for(lt=!0;U.size>0;){const i=Array.from(U);U.clear();for(const e of i){const t=G.get(e)??e.prevState;e.prevState=t,$t(e)}for(const e of i){const t=N.get(e);t&&(Z.current.push(e),Lt(t))}for(const e of i){const t=N.get(e);if(t)for(const s of t)Bt(s)}}}finally{lt=!1,Z.current=[],G.clear()}}function A(r){W++;try{r()}finally{if(W--,W===0){const i=U.values().next().value;i&&Tt(i)}}}function Nt(r){return typeof r=="function"}class tt{constructor(i,e){this.listeners=new Set,this.subscribe=t=>{var s,n;this.listeners.add(t);const a=(n=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:n.call(s,t,this);return()=>{this.listeners.delete(t),a?.()}},this.prevState=i,this.state=i,this.options=e}setState(i){var e,t,s;this.prevState=this.state,(e=this.options)!=null&&e.updateFn?this.state=this.options.updateFn(this.prevState)(i):Nt(i)?this.state=i(this.prevState):this.state=i,(s=(t=this.options)==null?void 0:t.onUpdate)==null||s.call(t),Tt(this)}}class L{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const e=this.options.deps.length,t=new Array(e),s=new Array(e);for(let n=0;n<e;n++){const a=this.options.deps[n];t[n]=a.prevState,s[n]=a.state}return this.lastSeenDepValues=s,{prevDepVals:t,currDepVals:s,prevVal:this.prevState??void 0}},this.recompute=()=>{var e,t;this.prevState=this.state;const s=this.getDepVals();this.state=this.options.fn(s),(t=(e=this.options).onUpdate)==null||t.call(e)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof L&&n.checkIfRecalculationNeededDeeply();let e=!1;const t=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let n=0;n<s.length;n++)if(s[n]!==t[n]){e=!0;break}e&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const e of this._subscriptions)e()}),this.subscribe=e=>{var t,s;this.listeners.add(e);const n=(s=(t=this.options).onSubscribe)==null?void 0:s.call(t,e,this);return()=>{this.listeners.delete(e),n?.()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const e of i)if(e instanceof L)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof tt){let t=N.get(e);t||(t=new Set,N.set(e,t)),t.add(this);let s=j.get(this);s||(s=new Set,j.set(this,s)),s.add(e)}}unregisterFromGraph(i=this.options.deps){for(const e of i)if(e instanceof L)this.unregisterFromGraph(e.options.deps);else if(e instanceof tt){const t=N.get(e);t&&t.delete(this);const s=j.get(this);s&&s.delete(e)}}}function Rt(r){return typeof r=="function"}function Mt(r,...i){return Rt(r)?r(...i):r}function xt(r){return r||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class It{#s=!0;#t;#e;#n;#i;#r;#a;#l;#d=0;#h=5;#o=!1;#c=()=>{this.debugLog("Connected to event bus"),this.#r=!0,this.#o=!1,this.debugLog("Emitting queued events",this.#i),this.#i.forEach(i=>this.emitEventToBus(i)),this.#i=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#c)};#u=()=>{if(this.#d<this.#h){this.#d++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#u),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#f=()=>{this.#o||(this.#o=!0,this.#e().addEventListener("tanstack-connect-success",this.#c),this.#u())};constructor({pluginId:i,debug:e=!1,enabled:t=!0,reconnectEveryMs:s=300}){this.#t=i,this.#s=t,this.#e=this.getGlobalTarget,this.#n=e,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#i=[],this.#r=!1,this.#a=null,this.#l=s}startConnectLoop(){this.#a!==null||this.#r||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#a=setInterval(this.#u,this.#l))}stopConnectLoop(){this.#o=!1,this.#a!==null&&(clearInterval(this.#a),this.#a=null,this.debugLog("Stopped connect loop"))}debugLog(...i){this.#n&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#t}-plugin]`,...i)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const i=typeof EventTarget<"u"?new EventTarget:void 0;return typeof i>"u"||typeof i.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),i)}getPluginId(){return this.#t}dispatchCustomEventShim(i,e){try{const t=new Event(i,{detail:e});this.#e().dispatchEvent(t)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(i,e){try{this.#e().dispatchEvent(new CustomEvent(i,{detail:e}))}catch{this.dispatchCustomEventShim(i,e)}}emitEventToBus(i){this.debugLog("Emitting event to client bus",i),this.dispatchCustomEvent("tanstack-dispatch-event",i)}emit(i,e){if(!this.#s){this.debugLog("Event bus client is disabled, not emitting event",i,e);return}if(!this.#r){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#i.push({type:`${this.#t}:${i}`,payload:e,pluginId:this.#t}),typeof CustomEvent<"u"&&!this.#o&&(this.#f(),this.startConnectLoop());return}return this.emitEventToBus({type:`${this.#t}:${i}`,payload:e,pluginId:this.#t})}on(i,e){const t=`${this.#t}:${i}`;if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event",t),()=>{};const s=n=>{this.debugLog("Received event from bus",n.detail),e(n.detail)};return this.#e().addEventListener(t,s),this.debugLog("Registered event to bus",t),()=>{this.#e().removeEventListener(t,s)}}onAll(i){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;i(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}onAllPluginEvents(i){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;this.#t&&s.pluginId!==this.#t||i(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}}class Ut extends It{constructor(i){super({pluginId:"pacer",debug:i?.debug})}}const Wt=(r,i)=>{Ct.emit(r,i)},Ct=new Ut;function Ft(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const Gt={enabled:!0,leading:!0,trailing:!0,wait:0};class zt{constructor(i,e){this.fn=i,this.store=new tt(Ft()),this.setOptions=t=>{this.options={...this.options,...t},this.#e()||this.cancel()},this.#t=t=>{this.store.setState(s=>{const n={...s,...t},{isPending:a}=n;return{...n,status:this.#e()?a?"pending":"idle":"disabled"}}),Wt("Throttler",this)},this.#e=()=>!!Mt(this.options.enabled,this),this.#n=()=>Mt(this.options.wait,this),this.maybeExecute=(...t)=>{this.#t({maybeExecuteCount:this.store.state.maybeExecuteCount+1});const s=Date.now(),n=s-this.store.state.lastExecutionTime,a=this.#n();if(this.options.leading&&n>=a)this.#i(...t);else if(this.#t({lastArgs:t}),!this.#s&&this.options.trailing){const c=this.store.state.lastExecutionTime?s-this.store.state.lastExecutionTime:0,u=a-c;this.#t({isPending:!0}),this.#s=setTimeout(()=>{const{lastArgs:o}=this.store.state;o!==void 0&&this.#i(...o)},u)}},this.#i=(...t)=>{if(!this.#e())return;this.fn(...t);const s=Date.now(),n=s+this.#n();this.#r(),this.#t({executionCount:this.store.state.executionCount+1,lastExecutionTime:s,nextExecutionTime:n,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(t,this),setTimeout(()=>{this.store.state.isPending||this.#t({nextExecutionTime:void 0})},this.#n())},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&this.#i(...this.store.state.lastArgs)},this.#r=()=>{this.#s&&(clearTimeout(this.#s),this.#s=void 0)},this.cancel=()=>{this.#r(),this.#t({lastArgs:void 0,isPending:!1})},this.reset=()=>{this.#t(Ft())},this.key=xt(e.key),this.options={...Gt,...e},this.#t(this.options.initialState??{}),Ct.on("d-Throttler",t=>{t.payload.key===this.key&&(this.#t(t.payload.store.state),this.setOptions(t.payload.options))})}#s;#t;#e;#n;#i;#r}function Kt(r,i){return new zt(r,i).maybeExecute}function rt(r,i){return typeof r=="function"?r(i):r}function $(r,i){return nt(i).reduce((t,s)=>{if(t===null)return null;if(typeof t<"u")return t[s]},r)}function z(r,i,e){const t=nt(i);function s(n){if(!t.length)return rt(e,n);const a=t.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[a]:s(n[a])}):{[a]:s()};if(Array.isArray(n)&&typeof a=="number"){const c=n.slice(0,a);return[...c.length?c:new Array(a),s(n[a]),...n.slice(a+1)]}return[...new Array(a),s()]}return s(r)}function Ht(r,i){const e=nt(i);function t(s){if(!s)return;if(e.length===1){const a=e[0];if(Array.isArray(s)&&typeof a=="number")return s.filter((o,l)=>l!==a);const{[a]:c,...u}=s;return u}const n=e.shift();if(typeof n=="string"&&typeof s=="object")return{...s,[n]:t(s[n])};if(typeof n=="number"&&Array.isArray(s)){if(n>=s.length)return s;const a=s.slice(0,n);return[...a.length?a:new Array(n),t(s[n]),...s.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(r)}const qt=/^(\d+)$/gm,Xt=/\.(\d+)(?=\.)/gm,jt=/^(\d+)\./gm,Jt=/\.(\d+$)/gm,Qt=/\.{2,}/gm,dt="__int__",K=`${dt}$1`;function nt(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(qt,K).replace(Xt,`.${K}.`).replace(jt,`${K}.`).replace(Jt,`.${K}`).replace(Qt,".").split(".").map(i=>{if(i.startsWith(dt)){const e=i.substring(dt.length),t=parseInt(e,10);return String(t)===e?t:e}return i})}function yt(r,i){return r.length===0?i:i.length===0?r:i.startsWith("[")||i.startsWith(".")?r+i:`${r}.${i}`}function Yt(r){return!(Array.isArray(r)&&r.length===0)}function ct(r,i){const e=t=>t.validators.filter(Boolean).map(s=>({cause:s.cause,validate:s.fn}));return i.validationLogic({form:i.form,validators:i.validators,event:{type:r,async:!1},runValidation:e})}function ht(r,i){const{asyncDebounceMs:e}=i,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:s,onDynamicAsyncDebounceMs:n}=i.validators||{},a=e??0,c=u=>u.validators.filter(Boolean).map(o=>{const l=o?.cause||r;let h=a;switch(l){case"change":h=s??a;break;case"blur":h=t??a;break;case"dynamic":h=n??a;break;case"submit":h=0;break}return r==="submit"&&(h=0),{cause:l,validate:o.fn,debounceMs:h}});return i.validationLogic({form:i.form,validators:i.validators,event:{type:r,async:!0},runValidation:c})}const ft=r=>!!r&&typeof r=="object"&&"fields"in r;function k(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Date&&i instanceof Date)return r.getTime()===i.getTime();if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[s,n]of r)if(!i.has(s)||!Object.is(n,i.get(s)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}const e=Object.keys(r),t=Object.keys(i);if(e.length!==t.length)return!1;for(const s of e)if(!t.includes(s)||!k(r[s],i[s]))return!1;return!0}const bt=({newFormValidatorError:r,isPreviousErrorFromFormValidator:i,previousErrorValue:e})=>r?{newErrorValue:r,newSource:"form"}:i?{newErrorValue:void 0,newSource:void 0}:e?{newErrorValue:e,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},Vt=({formLevelError:r,fieldLevelError:i})=>i?{newErrorValue:i,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function S(r,i){return r==null?i:{...r,...i}}let _=256;const J=[];let H;for(;_--;)J[_]=(_+256).toString(16).substring(1);function Zt(){let r=0,i,e="";if(!H||_+16>256){for(H=new Array(256),r=256;r--;)H[r]=256*Math.random()|0;r=0,_=0}for(;r<16;r++)i=H[_+r],r===6?e+=J[i&15|64]:r===8?e+=J[i&63|128]:e+=J[i],r&1&&r>1&&r<11&&(e+="-");return _++,e}const B=r=>{if(!r.validators)return r.runValidation({validators:[],form:r.form});const i=r.event.async,e=i?void 0:{fn:r.validators.onMount,cause:"mount"},t={fn:i?r.validators.onChangeAsync:r.validators.onChange,cause:"change"},s={fn:i?r.validators.onBlurAsync:r.validators.onBlur,cause:"blur"},n={fn:i?r.validators.onSubmitAsync:r.validators.onSubmit,cause:"submit"},a=i?void 0:{fn:()=>{},cause:"server"};switch(r.event.type){case"mount":return r.runValidation({validators:[e],form:r.form});case"submit":return r.runValidation({validators:[t,s,n,a],form:r.form});case"server":return r.runValidation({validators:[],form:r.form});case"blur":return r.runValidation({validators:[s,a],form:r.form});case"change":return r.runValidation({validators:[t,a],form:r.form});default:throw new Error(`Unknown validation event type: ${r.event.type}`)}};function te(r,i){const e=new Map;for(const t of r){const s=t.path??[];let n=i,a="";for(let c=0;c<s.length;c++){const u=s[c];if(u===void 0)continue;const o=typeof u=="object"?u.key:u,l=Number(o);Array.isArray(n)&&!Number.isNaN(l)?a+=`[${l}]`:a+=(c>0?".":"")+String(o),typeof n=="object"&&n!==null?n=n[o]:n=void 0}e.set(a,(e.get(a)??[]).concat(t))}return Object.fromEntries(e)}const St=(r,i)=>{const e=te(r,i);return{form:e,fields:e}},R={validate({value:r,validationSource:i},e){const t=e["~standard"].validate(r);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return i==="field"?t.issues:St(t.issues,r)},async validateAsync({value:r,validationSource:i},e){const t=await e["~standard"].validate(r);if(t.issues)return i==="field"?t.issues:St(t.issues,r)}},kt=r=>!!r&&"~standard"in r,et={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function q(r){function i(l,h,d){const f=a(l,h,"move",d),m=Math.min(h,d),g=Math.max(h,d);for(let v=m;v<=g;v++)f.push(n(l,v));const M=Object.keys(r.fieldInfo).reduce((v,p)=>(p.startsWith(n(l,h))&&v.set(p,r.getFieldMeta(p)),v),new Map);u(f,h<d?"up":"down"),Object.keys(r.fieldInfo).filter(v=>v.startsWith(n(l,d))).forEach(v=>{const p=v.replace(n(l,d),n(l,h)),y=M.get(p);y&&r.setFieldMeta(v,y)})}function e(l,h){const d=a(l,h,"remove");u(d,"up")}function t(l,h,d){a(l,h,"swap",d).forEach(m=>{if(!m.toString().startsWith(n(l,h)))return;const g=m.toString().replace(n(l,h),n(l,d)),[M,v]=[r.getFieldMeta(m),r.getFieldMeta(g)];M&&r.setFieldMeta(g,M),v&&r.setFieldMeta(m,v)})}function s(l,h){const d=a(l,h,"insert");u(d,"down"),d.forEach(f=>{f.toString().startsWith(n(l,h))&&r.setFieldMeta(f,o())})}function n(l,h){return`${l}[${h}]`}function a(l,h,d,f){const m=[n(l,h)];switch(d){case"swap":m.push(n(l,f));break;case"move":{const[g,M]=[Math.min(h,f),Math.max(h,f)];for(let v=g;v<=M;v++)m.push(n(l,v));break}default:{const g=r.getFieldValue(l),M=Array.isArray(g)?g.length:0;for(let v=h+1;v<M;v++)m.push(n(l,v));break}}return Object.keys(r.fieldInfo).filter(g=>m.some(M=>g.startsWith(M)))}function c(l,h){return l.replace(/\[(\d+)\]/,(d,f)=>{const m=parseInt(f,10);return`[${h==="up"?m+1:Math.max(0,m-1)}]`})}function u(l,h){(h==="up"?l:[...l].reverse()).forEach(f=>{const m=c(f.toString(),h),g=r.getFieldMeta(m);g?r.setFieldMeta(f,g):r.setFieldMeta(f,o())})}const o=()=>et;return{handleArrayMove:i,handleArrayRemove:e,handleArraySwap:t,handleArrayInsert:s}}class ee extends It{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const w=new ee;function ut(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class se{constructor(i){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),s=this.store.mount(),n=()=>{t(),s(),w.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:a}=this.options.validators||{};return w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),a&&this.validateSync("mount"),n},this.update=t=>{if(!t)return;const s=this.options;this.options=t;const n=!!t.transform?.deps?.some((u,o)=>u!==this.prevTransformArray[o]),a=t.defaultValues&&!k(t.defaultValues,s.defaultValues)&&!this.state.isTouched,c=!k(t.defaultState,s.defaultState)&&!this.state.isTouched;!a&&!c&&!n||(A(()=>{this.baseStore.setState(()=>ut(Object.assign({},this.state,c?t.defaultState:{},a?{values:t.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))}),w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,s)=>{const{fieldMeta:n}=this.state,a=this.resetFieldMeta(n);t&&!s?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>ut({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:a}))},this.validateAllFields=async t=>{const s=[];return A(()=>{Object.values(this.fieldInfo).forEach(a=>{if(!a.instance)return;const c=a.instance;s.push(Promise.resolve().then(()=>c.validate(t,{skipFormValidation:!0}))),a.instance.state.meta.isTouched||a.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(t,s,n)=>{const a=this.getFieldValue(t),c=Array.isArray(a)?Math.max(a.length-1,0):null,u=[`${t}[${s}]`];for(let d=s+1;d<=(c??0);d++)u.push(`${t}[${d}]`);const o=Object.keys(this.fieldInfo).filter(d=>u.some(f=>d.startsWith(f))),l=[];return A(()=>{o.forEach(d=>{l.push(Promise.resolve().then(()=>this.validateField(d,n)))})}),(await Promise.all(l)).flat()},this.validateField=(t,s)=>{const n=this.fieldInfo[t]?.instance;return n?(n.state.meta.isTouched||n.setMeta(a=>({...a,isTouched:!0})),n.validate(s)):[]},this.validateSync=t=>{const s=ct(t,{...this.options,form:this,validationLogic:this.options.validationLogic||B});let n=!1;const a={};return A(()=>{for(const o of s){if(!o.validate)continue;const l=this.runValidator({validate:o.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:d}=Q(l),f=x(o.cause);for(const m of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[m]===void 0)continue;const g=this.getFieldMeta(m);if(!g)continue;const{errorMap:M,errorSourceMap:v}=g,p=d?.[m],{newErrorValue:y,newSource:V}=bt({newFormValidatorError:p,isPreviousErrorFromFormValidator:v?.[f]==="form",previousErrorValue:M?.[f]});V==="form"&&(a[m]={...a[m],[f]:p}),M?.[f]!==y&&this.setFieldMeta(m,b=>({...b,errorMap:{...b.errorMap,[f]:y},errorSourceMap:{...b.errorSourceMap,[f]:V}}))}this.state.errorMap?.[f]!==h&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[f]:h}})),(h||d)&&(n=!0)}const c=x("submit");this.state.errorMap?.[c]&&t!=="submit"&&!n&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[c]:void 0}}));const u=x("server");this.state.errorMap?.[u]&&t!=="server"&&!n&&this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[u]:void 0}}))}),{hasErrored:n,fieldsErrorMap:a}},this.validateAsync=async t=>{const s=ht(t,{...this.options,form:this,validationLogic:this.options.validationLogic||B});this.state.isFormValidating||this.baseStore.setState(o=>({...o,isFormValidating:!0}));const n=[];let a;for(const o of s){if(!o.validate)continue;const l=x(o.cause);this.state.validationMetaMap[l]?.lastAbortController.abort();const d=new AbortController;this.state.validationMetaMap[l]={lastAbortController:d},n.push(new Promise(async f=>{let m;try{m=await new Promise((p,y)=>{setTimeout(async()=>{if(d.signal.aborted)return p(void 0);try{p(await this.runValidator({validate:o.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:d.signal},type:"validateAsync"}))}catch(V){y(V)}},o.debounceMs)})}catch(p){m=p}const{formError:g,fieldErrors:M}=Q(m);M&&(a=a?{...a,...M}:M);const v=x(o.cause);for(const p of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[p]===void 0)continue;const y=this.getFieldMeta(p);if(!y)continue;const{errorMap:V,errorSourceMap:b}=y,T=a?.[p],{newErrorValue:I,newSource:E}=bt({newFormValidatorError:T,isPreviousErrorFromFormValidator:b?.[v]==="form",previousErrorValue:V?.[v]});V?.[v]!==I&&this.setFieldMeta(p,C=>({...C,errorMap:{...C.errorMap,[v]:I},errorSourceMap:{...C.errorSourceMap,[v]:E}}))}this.baseStore.setState(p=>({...p,errorMap:{...p.errorMap,[v]:g}})),f(a?{fieldErrors:a,errorMapKey:v}:void 0)}))}let c=[];const u={};if(n.length){c=await Promise.all(n);for(const o of c)if(o?.fieldErrors){const{errorMapKey:l}=o;for(const[h,d]of Object.entries(o.fieldErrors)){const m={...u[h]||{},[l]:d};u[h]=m}}}return this.baseStore.setState(o=>({...o,isFormValidating:!1})),u},this.validate=t=>{const{hasErrored:s,fieldsErrorMap:n}=this.validateSync(t);return s&&!this.options.asyncAlways?n:this.validateAsync(t)},this.getFieldValue=t=>$(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,s)=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[t]:rt(s,n.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((s,n)=>{const a=n;return s[a]=et,s},{}),this.setFieldValue=(t,s,n)=>{const a=n?.dontUpdateMeta??!1,c=n?.dontRunListeners??!1,u=n?.dontValidate??!1;A(()=>{a||this.setFieldMeta(t,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o?.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:z(o.values,t,s)}))}),c||this.getFieldInfo(t).instance?.triggerOnChangeListener(),u||this.validateField(t,"change")},this.deleteField=t=>{const n=[...Object.keys(this.fieldInfo).filter(a=>{const c=t.toString();return a!==c&&a.startsWith(c)}),t];this.baseStore.setState(a=>{const c={...a};return n.forEach(u=>{c.values=Ht(c.values,u),delete this.fieldInfo[u],delete c.fieldMetaBase[u]}),c})},this.pushFieldValue=(t,s,n)=>{this.setFieldValue(t,a=>[...Array.isArray(a)?a:[],s],n)},this.insertFieldValue=async(t,s,n,a)=>{this.setFieldValue(t,u=>[...u.slice(0,s),n,...u.slice(s)],S(a,{dontValidate:!0}));const c=a?.dontValidate??!1;c||await this.validateField(t,"change"),q(this).handleArrayInsert(t,s),c||await this.validateArrayFieldsStartingFrom(t,s,"change")},this.replaceFieldValue=async(t,s,n,a)=>{this.setFieldValue(t,u=>u.map((o,l)=>l===s?n:o),S(a,{dontValidate:!0})),(a?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.removeFieldValue=async(t,s,n)=>{const a=this.getFieldValue(t),c=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(t,o=>o.filter((l,h)=>h!==s),S(n,{dontValidate:!0})),q(this).handleArrayRemove(t,s),c!==null){const o=`${t}[${c}]`;this.deleteField(o)}(n?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.swapFieldValues=(t,s,n,a)=>{this.setFieldValue(t,u=>{const o=u[s],l=u[n];return z(z(u,`${s}`,l),`${n}`,o)},S(a,{dontValidate:!0})),q(this).handleArraySwap(t,s,n),(a?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.moveFieldValues=(t,s,n,a)=>{this.setFieldValue(t,u=>{const o=[...u];return o.splice(n,0,o.splice(s,1)[0]),o},S(a,{dontValidate:!0})),q(this).handleArrayMove(t,s,n),(a?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.clearFieldValues=(t,s)=>{const n=this.getFieldValue(t),a=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(t,[],S(s,{dontValidate:!0})),a!==null)for(let u=0;u<=a;u++){const o=`${t}[${u}]`;this.deleteField(o)}(s?.dontValidate??!1)||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[t]:et},values:this.options.defaultValues?z(s.values,t,$(this.options.defaultValues,t)):s.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[s,n])=>(Object.keys(n).length&&n.errors.length&&(t[s]={errors:n.errors,errorMap:n.errorMap}),t),{})}),this.parseValuesWithSchema=t=>R.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>R.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=i?.formId??Zt(),this._devtoolsSubmissionOverride=!1,this.baseStore=new tt(ut({...i?.defaultState,values:i?.defaultValues??i?.defaultState?.values})),this.fieldMetaDerived=new L({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const a=n,c=t?.[0],u=s[0];let o=0;const l={};for(const h of Object.keys(u.fieldMetaBase)){const d=u.fieldMetaBase[h],f=c?.fieldMetaBase[h],m=a?.[h],g=$(u.values,h);let M=m?.errors;if(!f||d.errorMap!==f.errorMap){M=Object.values(d.errorMap??{}).filter(b=>b!==void 0);const V=this.getFieldInfo(h)?.instance;V&&!V.options.disableErrorFlat&&(M=M.flat(1))}const v=!Yt(M),p=!d.isDirty,y=k(g,$(this.options.defaultValues,h))||k(g,this.getFieldInfo(h)?.instance?.options.defaultValue);if(m&&m.isPristine===p&&m.isValid===v&&m.isDefaultValue===y&&m.errors===M&&d===f){l[h]=m,o++;continue}l[h]={...d,errors:M??[],isPristine:p,isValid:v,isDefaultValue:y}}return Object.keys(u.fieldMetaBase).length&&a&&o===Object.keys(u.fieldMetaBase).length?a:l}}),this.store=new L({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const a=n,c=t?.[0],u=s[0],o=s[1],l=Object.values(o).filter(Boolean),h=l.some(F=>F.isValidating),d=l.every(F=>F.isValid),f=l.some(F=>F.isTouched),m=l.some(F=>F.isBlurred),g=l.every(F=>F.isDefaultValue),M=f&&u.errorMap?.onMount,v=l.some(F=>F.isDirty),p=!v,y=!!(u.errorMap?.onMount||l.some(F=>F?.errorMap?.onMount)),V=!!h;let b=a?.errors??[];(!c||u.errorMap!==c.errorMap)&&(b=Object.values(u.errorMap).reduce((F,O)=>O===void 0?F:O&&ft(O)?(F.push(O.form),F):(F.push(O),F),[]));const T=b.length===0,I=d&&T,E=this.options.canSubmitWhenInvalid??!1,C=u.submissionAttempts===0&&!f&&!y||!V&&!u.isSubmitting&&I||E;let P=u.errorMap;if(M&&(b=b.filter(F=>F!==u.errorMap.onMount),P=Object.assign(P,{onMount:void 0})),a&&c&&a.errorMap===P&&a.fieldMeta===this.fieldMetaDerived.state&&a.errors===b&&a.isFieldsValidating===h&&a.isFieldsValid===d&&a.isFormValid===T&&a.isValid===I&&a.canSubmit===C&&a.isTouched===f&&a.isBlurred===m&&a.isPristine===p&&a.isDefaultValue===g&&a.isDirty===v&&k(c,u))return a;let at={...u,errorMap:P,fieldMeta:this.fieldMetaDerived.state,errors:b,isFieldsValidating:h,isFieldsValid:d,isFormValid:T,isValid:I,canSubmit:C,isTouched:f,isBlurred:m,isPristine:p,isDefaultValue:g,isDirty:v};const ot=this.options.transform?.deps??[];if(ot.length!==this.prevTransformArray.length||ot.some((F,O)=>F!==this.prevTransformArray[O])){const F=Object.assign({},this,{state:at});this.options.transform?.fn(F),at=F.state,this.prevTransformArray=ot}return at}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(i||{});const e=Kt(t=>w.emit("form-state",{id:this._formId,state:t}),{wait:300});this.store.subscribe(()=>{e(this.store.state)}),w.on("request-form-state",t=>{t.payload.id===this._formId&&w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),w.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),w.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(i){return kt(i.validate)?R[i.type](i.value,i.validate):i.validate(i.value)}async handleSubmit(i){this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(n=>({...n,isTouched:!0})))})});const e=i??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}this.baseStore.setState(s=>({...s,isSubmitting:!0}));const t=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(s=>s.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),A(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),t()})}catch(s){throw this.baseStore.setState(n=>({...n,isSubmitSuccessful:!1})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:s}),t(),s}}setErrorMap(i){A(()=>{Object.entries(i).forEach(([e,t])=>{const s=e;if(ft(t)){const{formError:n,fieldErrors:a}=Q(t);for(const c of Object.keys(this.fieldInfo))this.getFieldMeta(c)&&this.setFieldMeta(c,o=>({...o,errorMap:{...o.errorMap,[s]:a?.[c]},errorSourceMap:{...o.errorSourceMap,[s]:"form"}}));this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[s]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[s]:t}}))})})}}function Q(r){if(r){if(ft(r)){const i=Q(r.form).formError,e=r.fields;return{formError:i,fieldErrors:e}}return{formError:r}}return{formError:void 0}}function x(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class ie{constructor(i){this.options={},this.mount=()=>{const e=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:s}=this.options.validators||{};if(s){const n=this.runValidator({validate:s,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});n&&this.setMeta(a=>({...a,errorMap:{...a?.errorMap,onMount:n},errorSourceMap:{...a?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),e},this.update=e=>{if(this.options=e,this.name=e.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const t=this.form.getFieldValue(this.name);k(t,e.defaultValue)||this.form.setFieldValue(this.name,e.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(e,t)=>{this.form.setFieldValue(this.name,e,S(t,{dontRunListeners:!0,dontValidate:!0})),t?.dontRunListeners||this.triggerOnChangeListener(),t?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=e=>this.form.setFieldMeta(this.name,e),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(e,t)=>{this.form.pushFieldValue(this.name,e,S(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(e,t,s)=>{this.form.insertFieldValue(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(e,t,s)=>{this.form.replaceFieldValue(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(e,t)=>{this.form.removeFieldValue(this.name,e,S(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(e,t,s)=>{this.form.swapFieldValues(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(e,t,s)=>{this.form.moveFieldValues(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=e=>{this.form.clearFieldValues(this.name,S(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=e=>{const t=Object.values(this.form.fieldInfo),s=[];for(const n of t){if(!n.instance)continue;const{onChangeListenTo:a,onBlurListenTo:c}=n.instance.options.validators||{};e==="change"&&a?.includes(this.name)&&s.push(n.instance),e==="blur"&&c?.includes(this.name)&&s.push(n.instance)}return s},this.validateSync=(e,t)=>{const s=ct(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||B}),a=this.getLinkedFields(e).reduce((o,l)=>{const h=ct(e,{...l.options,form:l.form,validationLogic:l.form.options.validationLogic||B});return h.forEach(d=>{d.field=l}),o.concat(h)},[]);let c=!1;A(()=>{const o=(l,h)=>{const d=X(h.cause),f=h.validate?Et(l.runValidator({validate:h.validate,value:{value:l.store.state.value,validationSource:"field",fieldApi:l},type:"validate"})):void 0,m=t[d],{newErrorValue:g,newSource:M}=Vt({formLevelError:m,fieldLevelError:f});l.state.meta.errorMap?.[d]!==g&&l.setMeta(v=>({...v,errorMap:{...v.errorMap,[d]:g},errorSourceMap:{...v.errorSourceMap,[d]:M}})),g&&(c=!0)};for(const l of s)o(this,l);for(const l of a)l.validate&&o(l.field,l)});const u=X("submit");return this.state.meta.errorMap?.[u]&&e!=="submit"&&!c&&this.setMeta(o=>({...o,errorMap:{...o.errorMap,[u]:void 0},errorSourceMap:{...o.errorSourceMap,[u]:void 0}})),{hasErrored:c}},this.validateAsync=async(e,t)=>{const s=ht(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||B}),n=await t,a=this.getLinkedFields(e),c=a.reduce((d,f)=>{const m=ht(e,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||B});return m.forEach(g=>{g.field=f}),d.concat(m)},[]);this.state.meta.isValidating||this.setMeta(d=>({...d,isValidating:!0}));for(const d of a)d.setMeta(f=>({...f,isValidating:!0}));const u=[],o=[],l=(d,f,m)=>{const g=X(f.cause);d.getInfo().validationMetaMap[g]?.lastAbortController.abort();const v=new AbortController;this.getInfo().validationMetaMap[g]={lastAbortController:v},m.push(new Promise(async p=>{let y;try{y=await new Promise((E,C)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(v.signal.aborted)return E(void 0);try{E(await this.runValidator({validate:f.validate,value:{value:d.store.state.value,fieldApi:d,signal:v.signal,validationSource:"field"},type:"validateAsync"}))}catch(P){C(P)}},f.debounceMs)})}catch(E){y=E}if(v.signal.aborted)return p(void 0);const V=Et(y),b=n[this.name]?.[g],{newErrorValue:T,newSource:I}=Vt({formLevelError:b,fieldLevelError:V});d.setMeta(E=>({...E,errorMap:{...E?.errorMap,[g]:T},errorSourceMap:{...E.errorSourceMap,[g]:I}})),p(T)}))};for(const d of s)d.validate&&l(this,d,u);for(const d of c)d.validate&&l(d.field,d,o);let h=[];(u.length||o.length)&&(h=await Promise.all(u),await Promise.all(o)),this.setMeta(d=>({...d,isValidating:!1}));for(const d of a)d.setMeta(f=>({...f,isValidating:!1}));return h.filter(Boolean)},this.validate=(e,t)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=t?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(e),{hasErrored:n}=this.validateSync(e,s[this.name]??{});if(n&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[X(e)]?.lastAbortController.abort(),this.state.meta.errors;const a=t?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(e);return this.validateAsync(e,a)},this.handleChange=e=>{this.setValue(e)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=e=>R.validate({value:this.state.value,validationSource:"field"},e),this.parseValueWithSchemaAsync=e=>R.validateAsync({value:this.state.value,validationSource:"field"},e),this.form=i.form,this.name=i.name,this.options=i,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new L({deps:[this.form.store],fn:()=>{const e=this.form.getFieldMeta(this.name)??{...et,...i.defaultMeta};let t=this.form.getFieldValue(this.name);return!e.isTouched&&t===void 0&&this.options.defaultValue!==void 0&&!k(t,this.options.defaultValue)&&(t=this.options.defaultValue),{value:t,meta:e}}})}get state(){return this.store.state}runValidator(i){return kt(i.validate)?R[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(e=>({...e,errorMap:{...e.errorMap,...i}}))}triggerOnBlurListener(){const i=this.form.options.listeners?.onBlurDebounceMs;i&&i>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},i)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}triggerOnChangeListener(){const i=this.form.options.listeners?.onChangeDebounceMs;i&&i>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},i)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})}}function Et(r){if(r)return r}function X(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class st{constructor(i){if(this.getFormFieldName=e=>{if(typeof this.fieldsMap=="string")return yt(this.fieldsMap,e);const t=nt(e)[0];if(typeof t!="string")return"";const s=e.slice(t.length),n=this.fieldsMap[t];return yt(n,s)},this.getFormFieldOptions=e=>{const t={...e},s=t.validators;if(t.name=this.getFormFieldName(e.name),s&&(s.onChangeListenTo||s.onBlurListenTo)){const n={...s},a=c=>{if(c)return c.map(u=>this.getFormFieldName(u))};n.onChangeListenTo=a(s.onChangeListenTo),n.onBlurListenTo=a(s.onBlurListenTo),t.validators=n}return t},this.mount=()=>this.store.mount(),this.validateArrayFieldsStartingFrom=async(e,t,s)=>this.form.validateArrayFieldsStartingFrom(this.getFormFieldName(e),t,s),this.validateField=(e,t)=>this.form.validateField(this.getFormFieldName(e),t),this.getFieldValue=e=>this.form.getFieldValue(this.getFormFieldName(e)),this.getFieldMeta=e=>this.form.getFieldMeta(this.getFormFieldName(e)),this.setFieldMeta=(e,t)=>this.form.setFieldMeta(this.getFormFieldName(e),t),this.setFieldValue=(e,t,s)=>this.form.setFieldValue(this.getFormFieldName(e),t,s),this.deleteField=e=>this.form.deleteField(this.getFormFieldName(e)),this.pushFieldValue=(e,t,s)=>this.form.pushFieldValue(this.getFormFieldName(e),t,s),this.insertFieldValue=async(e,t,s,n)=>this.form.insertFieldValue(this.getFormFieldName(e),t,s,n),this.replaceFieldValue=async(e,t,s,n)=>this.form.replaceFieldValue(this.getFormFieldName(e),t,s,n),this.removeFieldValue=async(e,t,s)=>this.form.removeFieldValue(this.getFormFieldName(e),t,s),this.swapFieldValues=(e,t,s,n)=>this.form.swapFieldValues(this.getFormFieldName(e),t,s,n),this.moveFieldValues=(e,t,s,n)=>this.form.moveFieldValues(this.getFormFieldName(e),t,s,n),this.clearFieldValues=(e,t)=>this.form.clearFieldValues(this.getFormFieldName(e),t),this.resetField=e=>this.form.resetField(this.getFormFieldName(e)),this.validateAllFields=e=>this.form.validateAllFields(e),i.form instanceof st){const e=i.form;if(this.form=e.form,typeof i.fields=="string")this.fieldsMap=e.getFormFieldName(i.fields);else{const t={...i.fields};for(const s in t)t[s]=e.getFormFieldName(t[s]);this.fieldsMap=t}}else this.form=i.form,this.fieldsMap=i.fields;this.store=new L({deps:[this.form.store],fn:({currDepVals:e})=>{const t=e[0];let s;if(typeof this.fieldsMap=="string")s=$(t.values,this.fieldsMap);else{s={};const n=this.fieldsMap;for(const a in n)s[a]=$(t.values,n[a])}return{values:s}}})}get state(){return this.store.state}async handleSubmit(i){return this.form.handleSubmit(i)}}function mt(r,i=e=>e){const[e,t]=wt(i(r.state)),s=r.subscribe(()=>{const n=i(r.state);re(e(),n)||t(()=>n)});return it(()=>{s()}),e}function re(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[t,s]of r)if(!i.has(t)||!Object.is(s,i.get(t)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const t of r)if(!i.has(t))return!1;return!0}if(r instanceof Date&&i instanceof Date)return r.getTime()===i.getTime();const e=Object.keys(r);if(e.length!==Object.keys(i).length)return!1;for(let t=0;t<e.length;t++)if(!Object.prototype.hasOwnProperty.call(i,e[t])||!Object.is(r[e[t]],i[e[t]]))return!1;return!0}function ne(r){const[i,e]=wt(r,{equals:!1}),t=r.store.subscribe(()=>e(r));return it(t),i}function Dt(r){const i=r(),e=new ie(i),t=e;t.Field=Ot;let s=!1;return vt(()=>{const n=e.mount();s=!0,it(()=>{n(),s=!1})}),At(()=>{s&&e.update(r())}),ne(t)}function Ot(r){const i=Dt(()=>{const{children:e,...t}=r;return t});return _t(()=>D(()=>r.children(i),{}))}function ae(r){const i=r?.(),e=new se(i),t=e;return t.Field=s=>D(Ot,Y(s,{form:e})),t.createField=s=>Dt(()=>({...s(),form:e})),t.useStore=s=>mt(e.store,s),t.Subscribe=s=>rt(s.children,mt(e.store,s.selector)),vt(e.mount),At(()=>e.update(r?.())),t}function oe(r){const i=r(),e=new st(i),t=i.form instanceof st?i.form.form:i.form,s=e;return s.AppForm=n=>D(t.AppForm,n),s.AppField=n=>D(t.AppField,Y(()=>e.getFormFieldOptions(n))),s.Field=n=>D(t.Field,Y(()=>e.getFormFieldOptions(n))),s.Subscribe=n=>{const a=mt(e.store,n.selector);return rt(n.children,a())},vt(()=>{const n=e.mount();it(()=>{n()})}),Object.assign(s,{...i.formComponents})}function de(){const r=gt(null);function i(){const s=pt(r);if(!s)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return s}const e=gt(null);function t(){const s=pt(e);if(!s)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return s}return{fieldContext:r,useFieldContext:i,useFormContext:t,formContext:e}}function ce(r){function i(s){const n=ae(s),a=o=>D(r.formContext.Provider,{value:n,get children(){return o.children}}),c=o=>{const[l,h]=Pt(o,["children"]);return D(n.Field,Y(h,{children:d=>D(r.fieldContext.Provider,{value:d,get children(){return l.children(Object.assign(d,r.fieldComponents))}})}))},u=n;u.AppField=c,u.AppForm=a;for(const[o,l]of Object.entries(r.formComponents))u[o]=l;return u}function e({render:s,props:n}){return a=>s({...n,...a})}function t({render:s,props:n,defaultValues:a}){return function(u){const o={form:u.form,fields:u.fields,defaultValues:a,formComponents:r.formComponents},l=oe(()=>o);return s({...n,...u,group:l})}}return{useAppForm:i,withForm:e,withFieldGroup:t}}export{ce as a,de as c};
