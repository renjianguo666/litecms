import{z as te,s as le,h as W,A as u,C as r,b as t,k,U as S,S as f,Q as se,F as Q,V as B,e as Z,d as ee,a0 as H}from"./vendor-ui-EoCh-MHn.js";import{r as C,s as ne,v as ae,w as ie,x as oe,y as de,z as ce,E as ue,F as he,G as ge,H as me,q as pe,J as fe}from"./main-DH-8hjXZ.js";import{f as ve,T as be}from"./tree-list-D-ltItZE.js";import{c as xe}from"./chevron-right-BwwnFwHg.js";import{r as _e}from"./rotate-ccw-BDszy3Z8.js";import{s as $e}from"./save-I9DKp6Ft.js";var we=u("<button type=button>清空"),ye=u('<div class="mt-1.5 flex flex-wrap gap-1">'),Se=u('<div class="mt-1 text-xs text-muted-foreground">未选择'),Ce=u('<div data-slot=tree-list-multi><div class="px-3 py-2 border-b bg-muted/50 shrink-0"><div class="flex items-center justify-between"><span class="text-sm font-medium"></span><div class="flex gap-1"><button type=button>全部</button></div></div></div><div class="flex-1 overflow-y-auto py-1 min-h-0">'),ke=u('<span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded bg-primary text-primary-foreground">'),Fe=u('<div class="py-8 text-center text-sm text-muted-foreground">'),Le=u("<button type=button>"),ze=u("<div>"),Ee=u("<span>"),Te=u('<span class="text-xs text-muted-foreground/60 mr-2">(当前)'),Ie=u('<div><div class="flex h-full shrink-0"><div class="relative h-full"style=width:18px><div class="absolute top-0"style=left:9px></div><div class=absolute style=left:9px;top:50%;width:9px></div></div></div><span>'),Ae=u('<div class="absolute top-0 h-full"style=left:9px>'),Ne=u('<div class="relative h-full"style=width:18px>'),Pe=u('<span class="w-4 shrink-0">');function Ve(x,o){const F=()=>o?.(),$=W(()=>{const e=x();return e.map((n,i)=>{const c=e[i+1],g=c?c.depth>n.depth:!1;return{...n,has_children:g}})}),E=()=>new Set($().filter(e=>e.has_children).map(e=>e.id)),[L,w]=ee(E()),[d,T]=ee(!0),I=()=>{d()?(w(new Set),T(!1)):(w(E()),T(!0))},j=(e,n)=>{n.stopPropagation();const i=new Set(L());i.has(e)?i.delete(e):i.add(e),w(i)},A=e=>{const n=$(),i=n[e];if(i.depth===0)return!0;let c=i.depth-1;for(let g=e-1;g>=0&&c>=0;g--){const m=n[g];if(m.depth===c){if(!L().has(m.id))return!1;c--}}return!0},N=(e,n)=>{const i=$();for(let c=e+1;c<i.length;c++){if(i[c].depth===n)return!1;if(i[c].depth<n)return!0}return!0};return{processedNodes:$,expanded:L,allExpanded:d,toggleAll:I,toggleExpand:j,isVisible:A,isLastInLevel:N,getTreeLines:e=>{const n=$(),i=n[e],c=[];for(let g=0;g<i.depth;g++){let m=-1;for(let y=e-1;y>=0;y--)if(n[y].depth===g){m=y;break}if(m===-1){c.push(!1);continue}c.push(!N(m,g))}return c},isDisabled:e=>e===F()}}function je(x){const[o]=le(x,["nodes","value","onChange","class","title","placeholder","disabledId","showIcon"]),{processedNodes:F,expanded:$,allExpanded:E,toggleAll:L,toggleExpand:w,isVisible:d,isLastInLevel:T,getTreeLines:I,isDisabled:j}=Ve(()=>o.nodes,()=>o.disabledId),A=W(()=>new Set(o.value)),N=e=>{const n=new Set(o.value);n.has(e)?n.delete(e):n.add(e),o.onChange(Array.from(n))},l=()=>{o.onChange([])},h=W(()=>{const e=[],n=A();for(const i of o.nodes)n.has(i.id)&&e.push(i.name);return e});return(()=>{var e=Ce(),n=e.firstChild,i=n.firstChild,c=i.firstChild,g=c.nextSibling,m=g.firstChild,y=m.firstChild,q=n.nextSibling;return r(c,()=>o.title??"选择节点"),r(g,t(f,{get when(){return o.value.length>0},get children(){var s=we();return s.$$click=l,k(()=>S(s,C("inline-flex items-center px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors"))),s}}),m),se(m,"click",L,!0),r(m,()=>E()?"收起":"展开",y),r(n,t(f,{get when(){return o.value.length>0},get children(){var s=ye();return r(s,t(Q,{get each(){return h()},children:v=>(()=>{var p=ke();return r(p,v),p})()})),s}}),null),r(n,t(f,{get when(){return o.value.length===0},get children(){return Se()}}),null),r(q,t(f,{get when(){return F().length>0},get fallback(){return(()=>{var s=Fe();return r(s,()=>o.placeholder??"暂无数据"),s})()},get children(){return t(Q,{get each(){return F()},children:(s,v)=>{const p=()=>j(s.id),b=()=>A().has(s.id),M=()=>T(v(),s.depth),R=()=>I(v()),O=()=>$().has(s.id),P=()=>b()?"1px solid hsl(var(--primary-foreground) / 0.6)":"1px solid hsl(var(--muted-foreground) / 0.3)";return t(f,{get when(){return d(v())},get children(){var _=Ie(),V=_.firstChild,K=V.firstChild,G=K.firstChild,re=G.nextSibling,D=V.nextSibling;return _.$$click=a=>{p()||(s.has_children?w(s.id,a):N(s.id))},r(V,t(Q,{get each(){return R()},children:a=>(()=>{var z=Ne();return r(z,t(f,{when:a,get children(){var U=Ae();return k(J=>B(U,"border-left",P())),U}})),z})()}),K),r(_,t(f,{get when(){return s.has_children},get fallback(){return Pe()},get children(){var a=Le();return a.$$click=z=>w(s.id,z),r(a,t(f,{get when(){return O()},get fallback(){return t(xe,{class:"size-3.5"})},get children(){return t(ne,{class:"size-3.5"})}})),k(()=>S(a,C("w-4 h-4 flex items-center justify-center shrink-0 rounded","transition-transform duration-200",b()?"text-primary-foreground/80 hover:text-primary-foreground":"text-muted-foreground hover:text-foreground"))),a}}),D),r(_,t(f,{get when(){return!s.has_children},get children(){var a=ze();return r(a,t(f,{get when(){return b()},get children(){return t(ae,{class:"size-3"})}})),k(()=>S(a,C("w-4 h-4 flex items-center justify-center shrink-0 rounded border",b()?"bg-primary-foreground/20 border-primary-foreground/40":"border-muted-foreground/30 group-hover:border-muted-foreground/50"))),a}}),D),r(_,t(f,{get when(){return o.showIcon!==!1},get children(){var a=Ee();return r(a,t(f,{get when(){return Z(()=>!!s.has_children)()&&O()},get fallback(){return t(ve,{class:"size-4"})},get children(){return t(ie,{class:"size-4"})}})),k(()=>S(a,C("ml-1 shrink-0",b()?"text-primary-foreground/80":"text-amber-500 dark:text-amber-400"))),a}}),D),r(D,()=>s.name),r(_,t(f,{get when(){return p()},get children(){return Te()}}),null),k(a=>{var z=C("group flex items-center h-7 mx-1 select-none rounded-sm","transition-colors duration-150",p()&&"opacity-50 cursor-not-allowed",!p()&&b()&&"bg-primary text-primary-foreground cursor-pointer",!p()&&!b()&&"hover:bg-accent hover:text-accent-foreground cursor-pointer"),U=M()?"50%":"100%",J=P(),X=P(),Y=C("text-sm ml-1.5 truncate pr-2",b()&&"font-medium");return z!==a.e&&S(_,a.e=z),U!==a.t&&B(G,"height",a.t=U),J!==a.a&&B(G,"border-left",a.a=J),X!==a.o&&B(re,"border-top",a.o=X),Y!==a.i&&S(D,a.i=Y),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),_}})}})}})),k(s=>{var v=C("flex flex-col rounded-lg border bg-card text-card-foreground overflow-hidden",o.class),p=C("inline-flex items-center gap-1 px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors");return v!==s.e&&S(e,s.e=v),p!==s.t&&S(m,s.t=p),s},{e:void 0,t:void 0}),e})()}te(["click"]);var De=u('<div class="lg:mr-68 space-y-4"><div class="bg-card rounded-lg border border-border shadow-sm"><div class="p-5 space-y-4"></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">摘要与封面</h2><div class="grid grid-cols-1 gap-4"><div class="grid grid-cols-2 gap-4"></div></div></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">推送至</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div></div><div class="flex items-center justify-between pt-2"><div class="flex gap-3">'),Ue=u('<aside class="hidden lg:block fixed right-6.5 top-20 bottom-4 w-64">'),Me=u('<div class="flex items-center gap-2"><label class="text-sm font-medium whitespace-nowrap">发布时间</label><input type=datetime-local class="h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">'),Re=u('<div class="h-full border border-border rounded-lg bg-card flex items-center justify-center">');function Je(x){const o=Math.random().toString(36).slice(2)+Date.now().toString(36),[F]=H(async()=>(await oe.list({page_size:100})).items??[]),[$]=H(async()=>(await de.list({page_size:100})).items??[]),[E]=H(async()=>(await ce.list({page_size:100})).items??[]),[L]=H(async()=>(await ue.list({page_size:100})).items??[]),w=x.mode==="create"?he:ge,d=me(()=>({defaultValues:x.defaultValues,validators:{onMount:w,onChange:w},onSubmit:async({value:l})=>{x.mode==="create"?await x.onSubmit({...l,upload_token:o}):await x.onSubmit({...l,upload_token:o})}})),T=async l=>(await fe.upload(l,o)).url,I=W(()=>{const l=F()??[];if(l.length===0)return[];const h=new Set(l.map(e=>e.parent_id).filter(e=>e!==null));return l.map(e=>({id:e.id,name:e.name,parent_id:e.parent_id??null,depth:e.depth,has_children:h.has(e.id)}))}),j=()=>($()??[]).map(l=>({label:l.name,value:l.id})),A=()=>(E()??[]).map(l=>({label:l.name,value:l.id})),N=()=>(L()??[]).map(l=>({label:l.name,value:l.id}));return t(d.Form,{class:"relative",get children(){return[(()=>{var l=De(),h=l.firstChild,e=h.firstChild,n=h.nextSibling,i=n.firstChild,c=i.firstChild,g=c.nextSibling,m=g.firstChild,y=n.nextSibling,q=y.firstChild,s=q.firstChild,v=s.nextSibling,p=y.nextSibling,b=p.firstChild;return r(e,t(d.StringField,{name:"title",placeholder:"请输入文章标题"}),null),r(e,t(d.EditorField,{name:"text",label:"文章内容",placeholder:"请输入文章内容...",minHeight:"400px",showWordCount:!0,onImageUpload:T}),null),r(g,t(d.TextareaField,{name:"description",label:"文章描述",placeholder:"简短描述文章内容（可选）",rows:3}),m),r(g,t(d.StringField,{name:"cover_url",label:"封面图片",placeholder:"请输入封面图片URL（可选）"}),m),r(m,t(d.StringField,{name:"source",label:"来源",placeholder:"文章来源（可选）"}),null),r(m,t(d.StringField,{name:"author",label:"作者",placeholder:"作者名称（可选）"}),null),r(v,t(d.ComboboxField,{name:"tag_ids",label:"标签",get options(){return j()},placeholder:"选择标签...",searchPlaceholder:"搜索标签..."}),null),r(v,t(d.ComboboxField,{name:"special_ids",label:"专题",get options(){return A()},placeholder:"选择专题...",searchPlaceholder:"搜索专题..."}),null),r(v,t(d.ComboboxField,{name:"feature_ids",label:"推荐位",get options(){return N()},placeholder:"选择推荐位...",searchPlaceholder:"搜索推荐位..."}),null),r(p,t(d.AppField,{name:"published_at",children:M=>(()=>{var R=Me(),O=R.firstChild,P=O.nextSibling;return P.$$input=_=>{const V=_.currentTarget.value;M().handleChange(V?`${V}:00Z`:null)},k(()=>P.value=M().state.value?.slice(0,16)??""),R})()}),b),r(b,t(d.ResetButton,{class:"gap-2",get children(){return[t(_e,{class:"size-4"}),"重置"]}}),null),r(b,t(d.SubmitButton,{class:"gap-2",get children(){return[t($e,{class:"size-4"}),Z(()=>x.submitText??"发布文章")]}}),null),l})(),(()=>{var l=Ue();return r(l,t(f,{get when(){return!F.loading},get fallback(){return(()=>{var h=Re();return r(h,t(pe,{class:"size-6 animate-spin text-muted-foreground"})),h})()},get children(){return Z(()=>x.mode==="create")()?t(d.AppField,{name:"category_ids",mode:"array",children:h=>t(je,{get nodes(){return I()},get value(){return h().state.value??[]},onChange:e=>h().handleChange(e),title:"选择栏目",class:"h-full shadow-sm"})}):t(d.AppField,{name:"category_id",children:h=>t(be,{get nodes(){return I()},get value(){return h().state.value??""},onChange:e=>h().handleChange(e),title:"选择栏目",class:"h-full shadow-sm",allowEmpty:!1})})}})),l})()]}})}te(["input"]);export{Je as A};
