import{a4 as M,s as ee,b as e,m as te,z as Me,d as f,f as Ie,Y as me,A as g,C as n,W as Ee,k as de,X as Ne,a0 as Pe,e as Le,S,F as Oe}from"./vendor-ui-EoCh-MHn.js";import{r as ne,p as je,o as Ae,L as T,t as v,B as x,Z as Ue,w as Ke,_ as ue,q as K,h as B,i as W,j as q,k as H,$ as fe,R as ge,l as J,D as V,m as Be}from"./main-Nj9AaWuF.js";import{p as We,t as qe}from"./trash-2-CfB_nnlj.js";import{p as He}from"./pencil-9WHZmswv.js";import"./vendor-form-BYywqLDt.js";import"./vendor-editor-B9FEBeCH.js";const Je=M,Ve=M.Trigger;function Xe(i){const[d,u]=ee(i,["class"]);return e(M.Portal,{get children(){return e(M.Content,te({get class(){return ne("bg-popover text-popover-foreground z-50 min-w-32 overflow-hidden rounded-md border p-1 shadow-md","animate-in fade-in-0 zoom-in-95",d.class)}},u))}})}function he(i){const[d,u]=ee(i,["class","variant"]);return e(M.Item,te({get class(){return ne("relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none select-none","focus:bg-accent focus:text-accent-foreground","data-disabled:pointer-events-none data-disabled:opacity-50","[&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",d.variant==="destructive"&&"text-destructive focus:bg-destructive/10 focus:text-destructive",d.class)}},u))}function Ye(i){const[d,u]=ee(i,["class"]);return e(M.Separator,te({get class(){return ne("bg-border -mx-1 my-1 h-px",d.class)}},u))}var Ze=g('<div class="h-full flex flex-col bg-muted rounded-lg overflow-hidden border border-border"><div class="flex items-center justify-between px-3 py-2 bg-accent/50 border-b border-border"><span class="text-xs text-muted-foreground font-mono"></span><div class="flex items-center gap-2 text-xs text-muted-foreground"><span> 行</span><span>•</span><span>Ctrl+S 保存</span></div></div><div class="flex-1 flex overflow-hidden"><div class="shrink-0 w-12 bg-accent/30 text-right pr-3 py-3 font-mono text-xs text-muted-foreground/60 select-none overflow-hidden"style=line-height:1.5rem></div><textarea id=code-editor class="flex-1 bg-transparent resize-none p-3 font-mono text-sm leading-6 outline-none text-foreground placeholder:text-foreground/30"placeholder=在此输入模板内容... style=tab-size:2;line-height:1.5rem>'),Ge=g("<div>");function Qe(i){let d;const[u,D]=f(1),I=a=>{const l=a.split(`
`).length;D(l)};Ie(()=>{I(i.value)}),me(()=>{I(i.value)});const z=a=>{const l=a.target;i.onChange(l.value),I(l.value)},_=a=>{if((a.ctrlKey||a.metaKey)&&a.key==="s"){a.preventDefault(),i.onSave?.();return}if(a.key==="Tab"){a.preventDefault();const l=a.target,m=l.selectionStart,C=l.selectionEnd,w=l.value,b="  ",E=w.substring(0,m)+b+w.substring(C);i.onChange(E),requestAnimationFrame(()=>{l.selectionStart=l.selectionEnd=m+b.length})}},h=a=>{const l=a.target,m=l.previousElementSibling;m&&(m.scrollTop=l.scrollTop)};return(()=>{var a=Ze(),l=a.firstChild,m=l.firstChild,C=m.nextSibling,w=C.firstChild,b=w.firstChild,E=l.nextSibling,F=E.firstChild,p=F.nextSibling;n(m,()=>i.language||"HTML / Jinja2"),n(w,u,b),n(F,()=>Array.from({length:u()},(re,N)=>(()=>{var P=Ge();return n(P,N+1),P})())),p.addEventListener("scroll",h),p.$$keydown=_,p.$$input=z;var k=d;return typeof k=="function"?Ne(k,p):d=p,Ee(p,"spellcheck",!1),de(()=>p.readOnly=i.readonly),de(()=>p.value=i.value),a})()}Me(["input","keydown"]);var et=g('<span class="ml-4 text-foreground">当前编辑: <code class="bg-muted px-1.5 py-0.5 rounded text-xs">'),tt=g("<div class=py-2>"),nt=g('<div class="flex flex-col gap-1.5"><span class="text-xs text-muted-foreground">命名格式例如 red_category.html,red_article.html special_[slug].html,tag_[slug].html'),rt=g('<div class="flex flex-col gap-1.5">'),lt=g('<div class=h-[calc(100vh-8rem)]><div class="flex items-center justify-between mb-4"><div class="text-sm text-muted-foreground">模板文件管理</div><div class="flex items-center gap-2"></div></div><div class="flex gap-4 h-[calc(100%-3rem)]"><div class="w-64 shrink-0 bg-card rounded-lg border border-border overflow-auto"><div class="px-3 py-2 border-b border-border flex items-center gap-2"><span class="font-medium text-sm">templates/</span></div></div><div class="flex-1 min-w-0 flex flex-col"><div class=flex-1>'),st=g('<span class="text-warning ml-1">*'),at=g('<div class="flex items-center justify-center py-8">'),it=g('<div class="text-center text-muted-foreground py-8 text-sm">暂无模板文件'),ot=g('<span class="text-sm truncate flex-1">'),ct=g('<div class="h-full flex items-center justify-center bg-card rounded-lg border border-border"><div class="text-center text-muted-foreground"><p class="text-lg mb-2">选择一个模板文件开始编辑</p><p class=text-sm>或点击「新建模板」创建新文件'),dt=g('<div class="h-full flex items-center justify-center bg-card rounded-lg border border-border">');function vt(){const i=je(),d=Ae(),[u,D]=f(""),[I,z]=f(""),[_,h]=f(!1),[a,l]=f(!1),[m,C]=f(""),[w,b]=f(!1),[E,F]=f(null),[p,k]=f(""),[re,N]=f(null),[P,X]=f(!1),[pe,L]=f(!1),[ve,Y]=f(null);let Z,R;const y=()=>i.path?decodeURIComponent(i.path):null,[G,{refetch:xe}]=Pe(()=>T.list()),O=()=>{xe()},le=()=>u()!==I(),_e=async t=>{h(!0);try{const c=await T.get(t);D(c.content),z(c.content)}catch{v.error("加载文件失败"),d("/templates")}finally{h(!1)}},j=t=>{d(`/templates/${encodeURIComponent(t)}`)},be=()=>{d("/templates")};me(()=>{const t=y();t?_e(t):(D(""),z(""))});const ye=t=>{if(y()!==t){if(le()){Y(()=>()=>j(t)),L(!0);return}j(t)}},$e=()=>{const t=ve();t&&t(),L(!1),Y(null)},Ce=()=>{L(!1),Y(null)},we=async()=>{const t=y();if(t){h(!0);try{await T.save(t,u()),z(u()),v.success("保存成功")}catch{v.error("保存失败")}finally{h(!1)}}},ke=t=>{N(t),X(!0)},Se=async()=>{const t=re();if(t){h(!0);try{await T.delete(t),X(!1),N(null),y()===t&&(be(),D(""),z("")),O(),v.success("删除成功")}catch{v.error("删除失败")}finally{h(!1)}}},se=async()=>{let t=m().trim();if(!t){v.error("请输入文件名");return}t.endsWith(".html")||(t=`${t}.html`),h(!0);try{await T.save(t,""),l(!1),C(""),O(),j(t),v.success("创建成功")}catch{v.error("创建失败")}finally{h(!1)}},De=t=>{F(t);const c=t.split("/").pop()||"";k(c),b(!0),setTimeout(()=>{if(R){R.focus();const $=c.lastIndexOf(".");$>0?R.setSelectionRange(0,$):R.select()}},0)},ae=async()=>{const t=E(),c=p().trim();if(!t||!c){v.error("请输入新文件名");return}if(!c.endsWith(".html")){v.error("文件名必须以 .html 结尾");return}h(!0);try{if(await T.rename(t,c),b(!1),F(null),k(""),O(),y()===t){const $=t.split("/").slice(0,-1).join("/"),A=$?`${$}/${c}`:c;j(A)}v.success("重命名成功")}catch{v.error("重命名失败")}finally{h(!1)}},ie=()=>{l(!1),C("")},oe=()=>{b(!1),F(null),k("")};return(()=>{var t=lt(),c=t.firstChild,$=c.firstChild;$.firstChild;var A=$.nextSibling,ze=c.nextSibling,Q=ze.firstChild,ce=Q.firstChild,Fe=ce.firstChild,Re=Q.nextSibling,Te=Re.firstChild;return n($,e(S,{get when(){return y()},get children(){var r=et(),s=r.firstChild,o=s.nextSibling;return n(o,y),n(r,(()=>{var U=Le(()=>!!le());return()=>U()&&st()})(),null),r}}),null),n(A,e(x,{variant:"default",size:"sm",onClick:()=>{l(!0),setTimeout(()=>Z?.focus(),0)},get children(){return[e(We,{class:"size-4"}),"新建模板"]}}),null),n(A,e(x,{variant:"ghost",size:"sm",onClick:O,get children(){return[e(Ue,{class:"size-4"}),"刷新"]}}),null),n(ce,e(Ke,{class:"size-4 text-warning"}),Fe),n(Q,e(S,{get when(){return!G.loading},get fallback(){return(()=>{var r=at();return n(r,e(K,{class:"size-5 animate-spin text-primary"})),r})()},get children(){var r=tt();return n(r,e(S,{get when(){return(G()??[]).length>0},get fallback(){return it()},get children(){return e(Oe,{get each(){return G()??[]},children:s=>e(Je,{get children(){return[e(Ve,{as:"div",get class(){return`group flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors hover:bg-muted ${y()===s?"bg-primary/10 text-primary":""}`},onClick:()=>ye(s),get children(){return[e(ue,{class:"size-4 shrink-0 text-muted-foreground"}),(()=>{var o=ot();return n(o,s),o})()]}}),e(Xe,{get children(){return[e(he,{class:"gap-2",onSelect:()=>De(s),get children(){return[e(He,{class:"size-4"}),"重命名"]}}),e(Ye,{}),e(he,{class:"gap-2",variant:"destructive",onSelect:()=>ke(s),get children(){return[e(qe,{class:"size-4"}),"删除"]}})]}})]}})})}})),r}}),null),n(Te,e(S,{get when(){return y()},get fallback(){return(()=>{var r=ct(),s=r.firstChild,o=s.firstChild;return n(s,e(ue,{class:"size-12 mx-auto mb-3 opacity-30"}),o),r})()},get children(){return e(S,{get when(){return!_()},get fallback(){return(()=>{var r=dt();return n(r,e(K,{class:"size-8 animate-spin text-primary"})),r})()},get children(){return e(Qe,{get value(){return u()},onChange:D,onSave:we})}})}})),n(t,e(V,{get open(){return a()},onOpenChange:l,get children(){return e(B,{class:"max-w-md",get children(){return[e(W,{get children(){return[e(q,{children:"新建模板文件"}),e(H,{class:"sr-only",children:"创建新的模板文件"})]}}),(()=>{var r=nt(),s=r.firstChild;return n(r,e(fe,{for:"new-file-name",children:"文件名"}),s),n(r,e(ge,{ref(o){var U=Z;typeof U=="function"?U(o):Z=o},id:"new-file-name",type:"text",placeholder:"例如: red_category.html",get value(){return m()},onInput:o=>C(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"?se():o.key==="Escape"&&ie()}}),s),r})(),e(J,{get children(){return[e(x,{variant:"outline",onClick:ie,children:"取消"}),e(x,{variant:"default",onClick:se,get disabled(){return _()||!m().trim()},get children(){return[e(S,{get when(){return _()},get children(){return e(K,{class:"size-4 animate-spin"})}}),"创建"]}})]}})]}})}}),null),n(t,e(V,{get open(){return w()},onOpenChange:b,get children(){return e(B,{class:"max-w-md",get children(){return[e(W,{get children(){return[e(q,{children:"重命名模板文件"}),e(H,{class:"sr-only",children:"修改模板文件的名称"})]}}),(()=>{var r=rt();return n(r,e(fe,{for:"rename-file-name",children:"新文件名"}),null),n(r,e(ge,{ref(s){var o=R;typeof o=="function"?o(s):R=s},id:"rename-file-name",type:"text",placeholder:"例如: blue_category.html",get value(){return p()},onInput:s=>k(s.currentTarget.value),onKeyDown:s=>{s.key==="Enter"?ae():s.key==="Escape"&&oe()}}),null),r})(),e(J,{get children(){return[e(x,{variant:"outline",onClick:oe,children:"取消"}),e(x,{variant:"default",onClick:ae,get disabled(){return _()||!p().trim()},get children(){return[e(S,{get when(){return _()},get children(){return e(K,{class:"size-4 animate-spin"})}}),"确定"]}})]}})]}})}}),null),n(t,e(V,{get open(){return P()},onOpenChange:X,get children(){return e(B,{showCloseButton:!1,get children(){return[e(W,{get children(){return[e(q,{children:"删除模板"}),e(H,{children:"删除后将无法恢复，确定要删除该模板吗？"})]}}),e(J,{get children(){return[e(Be,{as:x,variant:"outline",children:"取消"}),e(x,{variant:"destructive",onClick:Se,get disabled(){return _()},get children(){return _()?"删除中...":"确认删除"}})]}})]}})}}),null),n(t,e(V,{get open(){return pe()},onOpenChange:L,get children(){return e(B,{showCloseButton:!1,get children(){return[e(W,{get children(){return[e(q,{children:"未保存的更改"}),e(H,{children:"当前文件有未保存的更改，是否放弃？"})]}}),e(J,{get children(){return[e(x,{variant:"outline",onClick:Ce,children:"取消"}),e(x,{variant:"default",onClick:$e,children:"放弃更改"})]}})]}})}}),null),t})()}export{vt as default};
