import{b as e,m as ie,z as he,d as j,a0 as P,A as l,C as t,S as h,F as Q,e as v,k as V,U as N}from"./vendor-ui-EoCh-MHn.js";import{I as me,z as I,n as fe,B as m,D as J,T as pe,e as xe,g as be,f as ve,h as W,i as X,j as Y,k as _e,l as Z,m as ee,q as A,Q as $e,R as ye,S as te,t as C,p as Ce,A as re,U as we,d as le,C as ne,a as se,b as ae,c as Se}from"./main-B6UhN7Jf.js";import{p as ke,t as ze}from"./trash-2-DtD5bXC7.js";import"./vendor-form-BYywqLDt.js";import"./vendor-editor-B9FEBeCH.js";var De=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],je=c=>e(me,ie(c,{iconNode:De,name:"grip-vertical"})),Ie=je,Ae=l('<div class="rounded-lg border border-border overflow-hidden"><table class="w-full text-sm"><thead><tr class="border-b border-border bg-muted/50"><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-8"></th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground">标题</th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-32">添加时间</th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-20">操作</th></tr></thead><tbody>'),Te=l('<div class="relative mb-4">'),Re=l('<table class="w-full text-sm"><thead><tr class="border-b border-border bg-muted/50"><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-8"></th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground">标题</th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-24">状态</th></tr></thead><tbody>'),Fe=l('<div class="min-h-[300px] max-h-[400px] overflow-y-auto border border-border rounded-lg">'),Me=l('<div class="text-sm text-muted-foreground">已选择 <!> 篇文章'),Ne=l('<div class=space-y-4><div class="flex items-center justify-between"><div class="text-sm text-muted-foreground">共 <!> 篇文章'),Pe=l('<div class="flex justify-center py-8">'),Be=l('<div class="text-center py-12 text-muted-foreground"><p class="text-lg mb-2">暂无文章</p><p class=text-sm>点击「添加文章」将文章加入此专题'),Ee=l('<span class="ml-2 inline-flex items-center px-1.5 py-0.5 text-xs font-medium rounded bg-primary/10 text-primary">头条'),He=l('<tr><td class="h-12 px-4 align-middle"></td><td class="h-12 px-4 align-middle"><span class=font-medium></span></td><td class="h-12 px-4 align-middle text-muted-foreground"></td><td class="h-12 px-4 align-middle">'),Ke=l('<div class="flex items-center justify-center h-[300px] text-muted-foreground">请输入关键词搜索文章'),Ue=l('<div class="flex items-center justify-center h-[300px]">'),qe=l('<div class="flex items-center justify-center h-[300px] text-muted-foreground">未找到相关文章'),Ge=l('<tr><td class="h-12 px-4 align-middle"></td><td class="h-12 px-4 align-middle"><span class=font-medium></span></td><td class="h-12 px-4 align-middle"><span>');function Le(c){const[u,f]=j(!1),[_,o]=j(""),[s,w]=j(new Set),[B,E]=j(!1),[S,{refetch:H}]=P(()=>c.specialId,r=>I.listContents(r)),[$]=P(()=>u()?_():null,async r=>!r||r.length<2?null:(await fe.list({search:r,page_size:20})).items),de=async r=>{try{await I.removeContent(c.specialId,r),C.success("移除成功"),H()}catch{C.error("移除失败")}},K=r=>{const a=new Set(s());a.has(r)?a.delete(r):a.add(r),w(a)},ce=r=>{w(r?new Set($()?.map(a=>a.id)??[]):new Set)},oe=async()=>{const r=Array.from(s());if(r.length===0){C.error("请选择要添加的文章");return}E(!0);try{const a=await I.addContents(c.specialId,r);C.success(`成功添加 ${a.added} 篇文章`),U(),H()}catch{C.error("添加失败")}finally{E(!1)}},U=()=>{f(!1),w(new Set),o("")},ue=r=>new Date(r).toLocaleDateString("zh-CN");return(()=>{var r=Ne(),a=r.firstChild,q=a.firstChild,ge=q.firstChild,G=ge.nextSibling;return G.nextSibling,t(q,()=>S()?.contents?.length??0,G),t(a,e(m,{size:"sm",onClick:()=>f(!0),get children(){return[e(ke,{class:"size-4"}),"添加文章"]}}),null),t(r,e(h,{get when(){return!S.loading},get fallback(){return(()=>{var n=Pe();return t(n,e(A,{class:"size-6 animate-spin text-primary"})),n})()},get children(){return e(h,{get when(){return S()?.contents?.length},get fallback(){return Be()},get children(){var n=Ae(),d=n.firstChild,p=d.firstChild,T=p.nextSibling;return t(T,e(Q,{get each(){return S()?.contents},children:(x,R)=>(()=>{var i=He(),k=i.firstChild,g=k.nextSibling,z=g.firstChild,y=g.nextSibling,F=y.nextSibling;return t(k,e(Ie,{class:"size-4 text-foreground/30 cursor-grab"})),t(z,()=>x.title),t(g,e(h,{get when(){return x.headline},get children(){return Ee()}}),null),t(y,()=>ue(x.added_at)),t(F,e(J,{get children(){return[e(pe,{get children(){return[e(xe,{as:M=>e(be,{as:D=>e(m,ie({variant:"ghost",size:"icon-sm",class:"text-destructive hover:text-destructive hover:bg-destructive/10"},M,D,{get children(){return e(ze,{class:"size-3.5"})}}))})}),e(ve,{children:"移除"})]}}),e(W,{get children(){return[e(X,{get children(){return[e(Y,{children:"移除文章"}),e(_e,{get children(){return["确定要从专题中移除「",v(()=>x.title),"」吗？"]}})]}}),e(Z,{get children(){return[e(ee,{as:m,variant:"outline",children:"取消"}),e(ee,{as:m,variant:"destructive",onClick:()=>de(x.content_id),children:"确认移除"})]}})]}})]}})),V(()=>N(i,`border-b border-border transition-colors hover:bg-muted/50 ${R()%2===1?"bg-muted/30":""}`)),i})()})),n}})}}),null),t(r,e(J,{get open(){return u()},onOpenChange:f,get children(){return e(W,{class:"max-w-2xl",get children(){return[e(X,{get children(){return e(Y,{children:"添加文章到专题"})}}),(()=>{var n=Te();return t(n,e($e,{class:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground pointer-events-none"}),null),t(n,e(ye,{type:"text",placeholder:"输入关键词搜索文章（至少2个字符）",class:"pl-10",get value(){return _()},onInput:d=>o(d.currentTarget.value)}),null),n})(),(()=>{var n=Fe();return t(n,e(h,{get when(){return _().length>=2},get fallback(){return Ke()},get children(){return e(h,{get when(){return!$.loading},get fallback(){return(()=>{var d=Ue();return t(d,e(A,{class:"size-6 animate-spin text-primary"})),d})()},get children(){return e(h,{get when(){return $()?.length},get fallback(){return qe()},get children(){var d=Re(),p=d.firstChild,T=p.firstChild,x=T.firstChild,R=p.nextSibling;return t(x,e(te,{get checked(){return v(()=>$()?.length===s().size)()&&s().size>0},onChange:ce})),t(R,e(Q,{get each(){return $()},children:(i,k)=>(()=>{var g=Ge(),z=g.firstChild,y=z.nextSibling,F=y.firstChild,M=y.nextSibling,D=M.firstChild;return g.$$click=()=>K(i.id),t(z,e(te,{get checked(){return s().has(i.id)},onChange:()=>K(i.id)})),t(F,()=>i.title),t(D,(()=>{var b=v(()=>i.status==="published");return()=>b()?"已发布":i.status==="draft"?"草稿":"已归档"})()),V(b=>{var L=`border-b border-border transition-colors hover:bg-muted/50 cursor-pointer ${k()%2===1?"bg-muted/30":""}`,O=`inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md border ${i.status==="published"?"bg-green-500/10 text-green-600 border-green-500/20 dark:text-green-400":i.status==="draft"?"bg-yellow-500/10 text-yellow-600 border-yellow-500/20 dark:text-yellow-400":"bg-muted text-muted-foreground border-border"}`;return L!==b.e&&N(g,b.e=L),O!==b.t&&N(D,b.t=O),b},{e:void 0,t:void 0}),g})()})),d}})}})}})),n})(),e(h,{get when(){return s().size>0},get children(){var n=Me(),d=n.firstChild,p=d.nextSibling;return p.nextSibling,t(n,()=>s().size,p),n}}),e(Z,{get children(){return[e(m,{variant:"outline",onClick:U,children:"取消"}),e(m,{get disabled(){return s().size===0||B()},onClick:oe,get children(){return[v(()=>v(()=>!!B())()&&e(A,{class:"size-4 animate-spin"})),"添加 ",v(()=>s().size)," 篇文章"]}})]}})]}})}}),null),r})()}he(["click"]);var Oe=l('<div class="flex items-start justify-between"><div class=space-y-1>'),Qe=l('<div class="mx-auto max-w-4xl space-y-6"><div>'),Ve=l('<div class="flex min-h-[400px] items-center justify-center">');function et(){const c=Ce(),[u]=P(()=>c.id,I.get);return(()=>{var f=Qe(),_=f.firstChild;return t(_,e(m,{as:re,href:"/specials",variant:"ghost",size:"sm",get children(){return[e(we,{class:"mr-2 h-4 w-4"}),"返回专题列表"]}})),t(f,e(h,{get when(){return v(()=>!u.loading)()&&u()},get fallback(){return(()=>{var o=Ve();return t(o,e(A,{class:"h-8 w-8 animate-spin text-muted-foreground"})),o})()},get children(){return[e(le,{get children(){return e(ne,{get children(){var o=Oe(),s=o.firstChild;return t(s,e(se,{get children(){return u().name}}),null),t(s,e(ae,{get children(){return u().title||u().slug}}),null),t(o,e(m,{as:re,get href(){return`/specials/${c.id}`},variant:"outline",size:"sm",children:"编辑专题"}),null),o}})}}),e(le,{get children(){return[e(ne,{get children(){return[e(se,{children:"内容管理"}),e(ae,{children:"管理与此专题关联的内容"})]}}),e(Se,{get children(){return e(Le,{get specialId(){return c.id}})}})]}})]}}),null),f})()}export{et as default};
