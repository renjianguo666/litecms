import{d as Ot,o as lt,e as zt,f as St,a as $t,b as k,m as it,s as Kt,g as Et,u as wt}from"./vendor-ui-EoCh-MHn.js";const B=new WeakMap,Y=new WeakMap,rt={current:[]};let ft=!1,z=0;const G=new Set,K=new Map;function Pt(r){const i=Array.from(r).sort((e,t)=>e instanceof U&&e.options.deps.includes(t)?1:t instanceof U&&t.options.deps.includes(e)?-1:0);for(const e of i){if(rt.current.includes(e))continue;rt.current.push(e),e.recompute();const t=Y.get(e);if(t)for(const s of t){const n=B.get(s);n&&Pt(n)}}}function Ht(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function qt(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function Bt(r){if(z>0&&!K.has(r)&&K.set(r,r.prevState),G.add(r),!(z>0)&&!ft)try{for(ft=!0;G.size>0;){const i=Array.from(G);G.clear();for(const e of i){const t=K.get(e)??e.prevState;e.prevState=t,Ht(e)}for(const e of i){const t=B.get(e);t&&(rt.current.push(e),Pt(t))}for(const e of i){const t=B.get(e);if(t)for(const s of t)qt(s)}}}finally{ft=!1,rt.current=[],K.clear()}}function A(r){z++;try{r()}finally{if(z--,z===0){const i=G.values().next().value;i&&Bt(i)}}}function Xt(r){return typeof r=="function"}let vt=class{constructor(i,e){this.listeners=new Set,this.subscribe=t=>{var s,n;this.listeners.add(t);const o=(n=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:n.call(s,t,this);return()=>{this.listeners.delete(t),o?.()}},this.prevState=i,this.state=i,this.options=e}setState(i){var e,t,s;this.prevState=this.state,(e=this.options)!=null&&e.updateFn?this.state=this.options.updateFn(this.prevState)(i):Xt(i)?this.state=i(this.prevState):this.state=i,(s=(t=this.options)==null?void 0:t.onUpdate)==null||s.call(t),Bt(this)}},U=class Z{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const e=this.options.deps.length,t=new Array(e),s=new Array(e);for(let n=0;n<e;n++){const o=this.options.deps[n];t[n]=o.prevState,s[n]=o.state}return this.lastSeenDepValues=s,{prevDepVals:t,currDepVals:s,prevVal:this.prevState??void 0}},this.recompute=()=>{var e,t;this.prevState=this.state;const s=this.getDepVals();this.state=this.options.fn(s),(t=(e=this.options).onUpdate)==null||t.call(e)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof Z&&n.checkIfRecalculationNeededDeeply();let e=!1;const t=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let n=0;n<s.length;n++)if(s[n]!==t[n]){e=!0;break}e&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const e of this._subscriptions)e()}),this.subscribe=e=>{var t,s;this.listeners.add(e);const n=(s=(t=this.options).onSubscribe)==null?void 0:s.call(t,e,this);return()=>{this.listeners.delete(e),n?.()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const e of i)if(e instanceof Z)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof vt){let t=B.get(e);t||(t=new Set,B.set(e,t)),t.add(this);let s=Y.get(this);s||(s=new Set,Y.set(this,s)),s.add(e)}}unregisterFromGraph(i=this.options.deps){for(const e of i)if(e instanceof Z)this.unregisterFromGraph(e.options.deps);else if(e instanceof vt){const t=B.get(e);t&&t.delete(this);const s=Y.get(this);s&&s.delete(e)}}};const N=new WeakMap,tt=new WeakMap,nt={current:[]};let mt=!1;const H=new Set,At=new Map;function Nt(r){const i=Array.from(r).sort((e,t)=>e instanceof R&&e.options.deps.includes(t)?1:t instanceof R&&t.options.deps.includes(e)?-1:0);for(const e of i){if(nt.current.includes(e))continue;nt.current.push(e),e.recompute();const t=tt.get(e);if(t)for(const s of t){const n=N.get(s);n&&Nt(n)}}}function jt(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function Jt(r){const i={prevVal:r.prevState,currentVal:r.state};for(const e of r.listeners)e(i)}function Qt(r){if(H.add(r),!mt)try{for(mt=!0;H.size>0;){const i=Array.from(H);H.clear();for(const e of i){const t=At.get(e)??e.prevState;e.prevState=t,jt(e)}for(const e of i){const t=N.get(e);t&&(nt.current.push(e),Nt(t))}for(const e of i){const t=N.get(e);if(t)for(const s of t)Jt(s)}}}finally{mt=!1,nt.current=[],At.clear()}}function Yt(r){return typeof r=="function"}class gt{constructor(i,e){this.listeners=new Set,this.subscribe=t=>{var s,n;this.listeners.add(t);const o=(n=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:n.call(s,t,this);return()=>{this.listeners.delete(t),o?.()}},this.prevState=i,this.state=i,this.options=e}setState(i){var e,t,s;this.prevState=this.state,(e=this.options)!=null&&e.updateFn?this.state=this.options.updateFn(this.prevState)(i):Yt(i)?this.state=i(this.prevState):this.state=i,(s=(t=this.options)==null?void 0:t.onUpdate)==null||s.call(t),Qt(this)}}class R{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const e=this.options.deps.length,t=new Array(e),s=new Array(e);for(let n=0;n<e;n++){const o=this.options.deps[n];t[n]=o.prevState,s[n]=o.state}return this.lastSeenDepValues=s,{prevDepVals:t,currDepVals:s,prevVal:this.prevState??void 0}},this.recompute=()=>{var e,t;this.prevState=this.state;const s=this.getDepVals();this.state=this.options.fn(s),(t=(e=this.options).onUpdate)==null||t.call(e)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof R&&n.checkIfRecalculationNeededDeeply();let e=!1;const t=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let n=0;n<s.length;n++)if(s[n]!==t[n]){e=!0;break}e&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const e of this._subscriptions)e()}),this.subscribe=e=>{var t,s;this.listeners.add(e);const n=(s=(t=this.options).onSubscribe)==null?void 0:s.call(t,e,this);return()=>{this.listeners.delete(e),n?.()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const e of i)if(e instanceof R)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof gt){let t=N.get(e);t||(t=new Set,N.set(e,t)),t.add(this);let s=tt.get(this);s||(s=new Set,tt.set(this,s)),s.add(e)}}unregisterFromGraph(i=this.options.deps){for(const e of i)if(e instanceof R)this.unregisterFromGraph(e.options.deps);else if(e instanceof gt){const t=N.get(e);t&&t.delete(this);const s=tt.get(this);s&&s.delete(e)}}}function Zt(r){return typeof r=="function"}function Lt(r,...i){return Zt(r)?r(...i):r}function te(r){return r||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class Rt{#s=!0;#t;#e;#n;#i;#r;#o;#l;#c=0;#h=5;#a=!1;#d=()=>{this.debugLog("Connected to event bus"),this.#r=!0,this.#a=!1,this.debugLog("Emitting queued events",this.#i),this.#i.forEach(i=>this.emitEventToBus(i)),this.#i=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#d)};#u=()=>{if(this.#c<this.#h){this.#c++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#u),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#f=()=>{this.#a||(this.#a=!0,this.#e().addEventListener("tanstack-connect-success",this.#d),this.#u())};constructor({pluginId:i,debug:e=!1,enabled:t=!0,reconnectEveryMs:s=300}){this.#t=i,this.#s=t,this.#e=this.getGlobalTarget,this.#n=e,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#i=[],this.#r=!1,this.#o=null,this.#l=s}startConnectLoop(){this.#o!==null||this.#r||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#o=setInterval(this.#u,this.#l))}stopConnectLoop(){this.#a=!1,this.#o!==null&&(clearInterval(this.#o),this.#o=null,this.debugLog("Stopped connect loop"))}debugLog(...i){this.#n&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#t}-plugin]`,...i)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const i=typeof EventTarget<"u"?new EventTarget:void 0;return typeof i>"u"||typeof i.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),i)}getPluginId(){return this.#t}dispatchCustomEventShim(i,e){try{const t=new Event(i,{detail:e});this.#e().dispatchEvent(t)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(i,e){try{this.#e().dispatchEvent(new CustomEvent(i,{detail:e}))}catch{this.dispatchCustomEventShim(i,e)}}emitEventToBus(i){this.debugLog("Emitting event to client bus",i),this.dispatchCustomEvent("tanstack-dispatch-event",i)}emit(i,e){if(!this.#s){this.debugLog("Event bus client is disabled, not emitting event",i,e);return}if(!this.#r){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#i.push({type:`${this.#t}:${i}`,payload:e,pluginId:this.#t}),typeof CustomEvent<"u"&&!this.#a&&(this.#f(),this.startConnectLoop());return}return this.emitEventToBus({type:`${this.#t}:${i}`,payload:e,pluginId:this.#t})}on(i,e){const t=`${this.#t}:${i}`;if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event",t),()=>{};const s=n=>{this.debugLog("Received event from bus",n.detail),e(n.detail)};return this.#e().addEventListener(t,s),this.debugLog("Registered event to bus",t),()=>{this.#e().removeEventListener(t,s)}}onAll(i){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;i(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}onAllPluginEvents(i){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;this.#t&&s.pluginId!==this.#t||i(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}}class ee extends Rt{constructor(i){super({pluginId:"pacer",debug:i?.debug})}}const se=(r,i)=>{xt.emit(r,i)},xt=new ee;function Tt(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const ie={enabled:!0,leading:!0,trailing:!0,wait:0};class re{constructor(i,e){this.fn=i,this.store=new gt(Tt()),this.setOptions=t=>{this.options={...this.options,...t},this.#e()||this.cancel()},this.#t=t=>{this.store.setState(s=>{const n={...s,...t},{isPending:o}=n;return{...n,status:this.#e()?o?"pending":"idle":"disabled"}}),se("Throttler",this)},this.#e=()=>!!Lt(this.options.enabled,this),this.#n=()=>Lt(this.options.wait,this),this.maybeExecute=(...t)=>{this.#t({maybeExecuteCount:this.store.state.maybeExecuteCount+1});const s=Date.now(),n=s-this.store.state.lastExecutionTime,o=this.#n();if(this.options.leading&&n>=o)this.#i(...t);else if(this.#t({lastArgs:t}),!this.#s&&this.options.trailing){const d=this.store.state.lastExecutionTime?s-this.store.state.lastExecutionTime:0,u=o-d;this.#t({isPending:!0}),this.#s=setTimeout(()=>{const{lastArgs:a}=this.store.state;a!==void 0&&this.#i(...a)},u)}},this.#i=(...t)=>{if(!this.#e())return;this.fn(...t);const s=Date.now(),n=s+this.#n();this.#r(),this.#t({executionCount:this.store.state.executionCount+1,lastExecutionTime:s,nextExecutionTime:n,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(t,this),setTimeout(()=>{this.store.state.isPending||this.#t({nextExecutionTime:void 0})},this.#n())},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&this.#i(...this.store.state.lastArgs)},this.#r=()=>{this.#s&&(clearTimeout(this.#s),this.#s=void 0)},this.cancel=()=>{this.#r(),this.#t({lastArgs:void 0,isPending:!1})},this.reset=()=>{this.#t(Tt())},this.key=te(e.key),this.options={...ie,...e},this.#t(this.options.initialState??{}),xt.on("d-Throttler",t=>{t.payload.key===this.key&&(this.#t(t.payload.store.state),this.setOptions(t.payload.options))})}#s;#t;#e;#n;#i;#r}function ne(r,i){return new re(r,i).maybeExecute}function ut(r,i){return typeof r=="function"?r(i):r}function $(r,i){return ct(i).reduce((t,s)=>{if(t===null)return null;if(typeof t<"u")return t[s]},r)}function q(r,i,e){const t=ct(i);function s(n){if(!t.length)return ut(e,n);const o=t.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[o]:s(n[o])}):{[o]:s()};if(Array.isArray(n)&&typeof o=="number"){const d=n.slice(0,o);return[...d.length?d:new Array(o),s(n[o]),...n.slice(o+1)]}return[...new Array(o),s()]}return s(r)}function oe(r,i){const e=ct(i);function t(s){if(!s)return;if(e.length===1){const o=e[0];if(Array.isArray(s)&&typeof o=="number")return s.filter((a,l)=>l!==o);const{[o]:d,...u}=s;return u}const n=e.shift();if(typeof n=="string"&&typeof s=="object")return{...s,[n]:t(s[n])};if(typeof n=="number"&&Array.isArray(s)){if(n>=s.length)return s;const o=s.slice(0,n);return[...o.length?o:new Array(n),t(s[n]),...s.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(r)}const ae=/^(\d+)$/gm,le=/\.(\d+)(?=\.)/gm,ue=/^(\d+)\./gm,ce=/\.(\d+$)/gm,de=/\.{2,}/gm,Ft="__int__",X=`${Ft}$1`;function ct(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(ae,X).replace(le,`.${X}.`).replace(ue,`${X}.`).replace(ce,`.${X}`).replace(de,".").split(".").map(i=>{if(i.startsWith(Ft)){const e=i.substring(Ft.length),t=parseInt(e,10);return String(t)===e?t:e}return i})}function Dt(r,i){return r.length===0?i:i.length===0?r:i.startsWith("[")||i.startsWith(".")?r+i:`${r}.${i}`}function he(r){return!(Array.isArray(r)&&r.length===0)}function Mt(r,i){const e=t=>t.validators.filter(Boolean).map(s=>({cause:s.cause,validate:s.fn}));return i.validationLogic({form:i.form,validators:i.validators,event:{type:r,async:!1},runValidation:e})}function Vt(r,i){const{asyncDebounceMs:e}=i,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:s,onDynamicAsyncDebounceMs:n}=i.validators||{},o=e??0,d=u=>u.validators.filter(Boolean).map(a=>{const l=a?.cause||r;let h=o;switch(l){case"change":h=s??o;break;case"blur":h=t??o;break;case"dynamic":h=n??o;break;case"submit":h=0;break}return r==="submit"&&(h=0),{cause:l,validate:a.fn,debounceMs:h}});return i.validationLogic({form:i.form,validators:i.validators,event:{type:r,async:!0},runValidation:d})}const yt=r=>!!r&&typeof r=="object"&&"fields"in r;function _(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Date&&i instanceof Date)return r.getTime()===i.getTime();if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[s,n]of r)if(!i.has(s)||!Object.is(n,i.get(s)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}const e=Object.keys(r),t=Object.keys(i);if(e.length!==t.length)return!1;for(const s of e)if(!t.includes(s)||!_(r[s],i[s]))return!1;return!0}const _t=({newFormValidatorError:r,isPreviousErrorFromFormValidator:i,previousErrorValue:e})=>r?{newErrorValue:r,newSource:"form"}:i?{newErrorValue:void 0,newSource:void 0}:e?{newErrorValue:e,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},kt=({formLevelError:r,fieldLevelError:i})=>i?{newErrorValue:i,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function S(r,i){return r==null?i:{...r,...i}}let C=256;const et=[];let j;for(;C--;)et[C]=(C+256).toString(16).substring(1);function fe(){let r=0,i,e="";if(!j||C+16>256){for(j=new Array(256),r=256;r--;)j[r]=256*Math.random()|0;r=0,C=0}for(;r<16;r++)i=j[C+r],r===6?e+=et[i&15|64]:r===8?e+=et[i&63|128]:e+=et[i],r&1&&r>1&&r<11&&(e+="-");return C++,e}const P=r=>{if(!r.validators)return r.runValidation({validators:[],form:r.form});const i=r.event.async,e=i?void 0:{fn:r.validators.onMount,cause:"mount"},t={fn:i?r.validators.onChangeAsync:r.validators.onChange,cause:"change"},s={fn:i?r.validators.onBlurAsync:r.validators.onBlur,cause:"blur"},n={fn:i?r.validators.onSubmitAsync:r.validators.onSubmit,cause:"submit"},o=i?void 0:{fn:()=>{},cause:"server"};switch(r.event.type){case"mount":return r.runValidation({validators:[e],form:r.form});case"submit":return r.runValidation({validators:[t,s,n,o],form:r.form});case"server":return r.runValidation({validators:[],form:r.form});case"blur":return r.runValidation({validators:[s,o],form:r.form});case"change":return r.runValidation({validators:[t,o],form:r.form});default:throw new Error(`Unknown validation event type: ${r.event.type}`)}};function me(r,i){const e=new Map;for(const t of r){const s=t.path??[];let n=i,o="";for(let d=0;d<s.length;d++){const u=s[d];if(u===void 0)continue;const a=typeof u=="object"?u.key:u,l=Number(a);Array.isArray(n)&&!Number.isNaN(l)?o+=`[${l}]`:o+=(d>0?".":"")+String(a),typeof n=="object"&&n!==null?n=n[a]:n=void 0}e.set(o,(e.get(o)??[]).concat(t))}return Object.fromEntries(e)}const It=(r,i)=>{const e=me(r,i);return{form:e,fields:e}},x={validate({value:r,validationSource:i},e){const t=e["~standard"].validate(r);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return i==="field"?t.issues:It(t.issues,r)},async validateAsync({value:r,validationSource:i},e){const t=await e["~standard"].validate(r);if(t.issues)return i==="field"?t.issues:It(t.issues,r)}},Ut=r=>!!r&&"~standard"in r,ot={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function J(r){function i(l,h,c){const f=o(l,h,"move",c),m=Math.min(h,c),v=Math.max(h,c);for(let p=m;p<=v;p++)f.push(n(l,p));const F=Object.keys(r.fieldInfo).reduce((p,g)=>(g.startsWith(n(l,h))&&p.set(g,r.getFieldMeta(g)),p),new Map);u(f,h<c?"up":"down"),Object.keys(r.fieldInfo).filter(p=>p.startsWith(n(l,c))).forEach(p=>{const g=p.replace(n(l,c),n(l,h)),V=F.get(g);V&&r.setFieldMeta(p,V)})}function e(l,h){const c=o(l,h,"remove");u(c,"up")}function t(l,h,c){o(l,h,"swap",c).forEach(m=>{if(!m.toString().startsWith(n(l,h)))return;const v=m.toString().replace(n(l,h),n(l,c)),[F,p]=[r.getFieldMeta(m),r.getFieldMeta(v)];F&&r.setFieldMeta(v,F),p&&r.setFieldMeta(m,p)})}function s(l,h){const c=o(l,h,"insert");u(c,"down"),c.forEach(f=>{f.toString().startsWith(n(l,h))&&r.setFieldMeta(f,a())})}function n(l,h){return`${l}[${h}]`}function o(l,h,c,f){const m=[n(l,h)];switch(c){case"swap":m.push(n(l,f));break;case"move":{const[v,F]=[Math.min(h,f),Math.max(h,f)];for(let p=v;p<=F;p++)m.push(n(l,p));break}default:{const v=r.getFieldValue(l),F=Array.isArray(v)?v.length:0;for(let p=h+1;p<F;p++)m.push(n(l,p));break}}return Object.keys(r.fieldInfo).filter(v=>m.some(F=>v.startsWith(F)))}function d(l,h){return l.replace(/\[(\d+)\]/,(c,f)=>{const m=parseInt(f,10);return`[${h==="up"?m+1:Math.max(0,m-1)}]`})}function u(l,h){(h==="up"?l:[...l].reverse()).forEach(f=>{const m=d(f.toString(),h),v=r.getFieldMeta(m);v?r.setFieldMeta(f,v):r.setFieldMeta(f,a())})}const a=()=>ot;return{handleArrayMove:i,handleArrayRemove:e,handleArraySwap:t,handleArrayInsert:s}}class pe extends Rt{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const w=new pe;function pt(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class ve{constructor(i){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),s=this.store.mount(),n=()=>{t(),s(),w.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:o}=this.options.validators||{};return w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),o&&this.validateSync("mount"),n},this.update=t=>{if(!t)return;const s=this.options;this.options=t;const n=!!t.transform?.deps?.some((u,a)=>u!==this.prevTransformArray[a]),o=t.defaultValues&&!_(t.defaultValues,s.defaultValues)&&!this.state.isTouched,d=!_(t.defaultState,s.defaultState)&&!this.state.isTouched;!o&&!d&&!n||(A(()=>{this.baseStore.setState(()=>pt(Object.assign({},this.state,d?t.defaultState:{},o?{values:t.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))}),w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,s)=>{const{fieldMeta:n}=this.state,o=this.resetFieldMeta(n);t&&!s?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>pt({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:o}))},this.validateAllFields=async t=>{const s=[];return A(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const d=o.instance;s.push(Promise.resolve().then(()=>d.validate(t,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(t,s,n)=>{const o=this.getFieldValue(t),d=Array.isArray(o)?Math.max(o.length-1,0):null,u=[`${t}[${s}]`];for(let c=s+1;c<=(d??0);c++)u.push(`${t}[${c}]`);const a=Object.keys(this.fieldInfo).filter(c=>u.some(f=>c.startsWith(f))),l=[];return A(()=>{a.forEach(c=>{l.push(Promise.resolve().then(()=>this.validateField(c,n)))})}),(await Promise.all(l)).flat()},this.validateField=(t,s)=>{const n=this.fieldInfo[t]?.instance;return n?(n.state.meta.isTouched||n.setMeta(o=>({...o,isTouched:!0})),n.validate(s)):[]},this.validateSync=t=>{const s=Mt(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});let n=!1;const o={};return A(()=>{for(const a of s){if(!a.validate)continue;const l=this.runValidator({validate:a.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:c}=st(l),f=W(a.cause);for(const m of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[m]===void 0)continue;const v=this.getFieldMeta(m);if(!v)continue;const{errorMap:F,errorSourceMap:p}=v,g=c?.[m],{newErrorValue:V,newSource:b}=_t({newFormValidatorError:g,isPreviousErrorFromFormValidator:p?.[f]==="form",previousErrorValue:F?.[f]});b==="form"&&(o[m]={...o[m],[f]:g}),F?.[f]!==V&&this.setFieldMeta(m,y=>({...y,errorMap:{...y.errorMap,[f]:V},errorSourceMap:{...y.errorSourceMap,[f]:b}}))}this.state.errorMap?.[f]!==h&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[f]:h}})),(h||c)&&(n=!0)}const d=W("submit");this.state.errorMap?.[d]&&t!=="submit"&&!n&&this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[d]:void 0}}));const u=W("server");this.state.errorMap?.[u]&&t!=="server"&&!n&&this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[u]:void 0}}))}),{hasErrored:n,fieldsErrorMap:o}},this.validateAsync=async t=>{const s=Vt(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});this.state.isFormValidating||this.baseStore.setState(a=>({...a,isFormValidating:!0}));const n=[];let o;for(const a of s){if(!a.validate)continue;const l=W(a.cause);this.state.validationMetaMap[l]?.lastAbortController.abort();const c=new AbortController;this.state.validationMetaMap[l]={lastAbortController:c},n.push(new Promise(async f=>{let m;try{m=await new Promise((g,V)=>{setTimeout(async()=>{if(c.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:a.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:c.signal},type:"validateAsync"}))}catch(b){V(b)}},a.debounceMs)})}catch(g){m=g}const{formError:v,fieldErrors:F}=st(m);F&&(o=o?{...o,...F}:F);const p=W(a.cause);for(const g of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[g]===void 0)continue;const V=this.getFieldMeta(g);if(!V)continue;const{errorMap:b,errorSourceMap:y}=V,L=o?.[g],{newErrorValue:T,newSource:E}=_t({newFormValidatorError:L,isPreviousErrorFromFormValidator:y?.[p]==="form",previousErrorValue:b?.[p]});b?.[p]!==T&&this.setFieldMeta(g,D=>({...D,errorMap:{...D.errorMap,[p]:T},errorSourceMap:{...D.errorSourceMap,[p]:E}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[p]:v}})),f(o?{fieldErrors:o,errorMapKey:p}:void 0)}))}let d=[];const u={};if(n.length){d=await Promise.all(n);for(const a of d)if(a?.fieldErrors){const{errorMapKey:l}=a;for(const[h,c]of Object.entries(a.fieldErrors)){const m={...u[h]||{},[l]:c};u[h]=m}}}return this.baseStore.setState(a=>({...a,isFormValidating:!1})),u},this.validate=t=>{const{hasErrored:s,fieldsErrorMap:n}=this.validateSync(t);return s&&!this.options.asyncAlways?n:this.validateAsync(t)},this.getFieldValue=t=>$(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,s)=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[t]:ut(s,n.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((s,n)=>{const o=n;return s[o]=ot,s},{}),this.setFieldValue=(t,s,n)=>{const o=n?.dontUpdateMeta??!1,d=n?.dontRunListeners??!1,u=n?.dontValidate??!1;A(()=>{o||this.setFieldMeta(t,a=>({...a,isTouched:!0,isDirty:!0,errorMap:{...a?.errorMap,onMount:void 0}})),this.baseStore.setState(a=>({...a,values:q(a.values,t,s)}))}),d||this.getFieldInfo(t).instance?.triggerOnChangeListener(),u||this.validateField(t,"change")},this.deleteField=t=>{const n=[...Object.keys(this.fieldInfo).filter(o=>{const d=t.toString();return o!==d&&o.startsWith(d)}),t];this.baseStore.setState(o=>{const d={...o};return n.forEach(u=>{d.values=oe(d.values,u),delete this.fieldInfo[u],delete d.fieldMetaBase[u]}),d})},this.pushFieldValue=(t,s,n)=>{this.setFieldValue(t,o=>[...Array.isArray(o)?o:[],s],n)},this.insertFieldValue=async(t,s,n,o)=>{this.setFieldValue(t,u=>[...u.slice(0,s),n,...u.slice(s)],S(o,{dontValidate:!0}));const d=o?.dontValidate??!1;d||await this.validateField(t,"change"),J(this).handleArrayInsert(t,s),d||await this.validateArrayFieldsStartingFrom(t,s,"change")},this.replaceFieldValue=async(t,s,n,o)=>{this.setFieldValue(t,u=>u.map((a,l)=>l===s?n:a),S(o,{dontValidate:!0})),(o?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.removeFieldValue=async(t,s,n)=>{const o=this.getFieldValue(t),d=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(t,a=>a.filter((l,h)=>h!==s),S(n,{dontValidate:!0})),J(this).handleArrayRemove(t,s),d!==null){const a=`${t}[${d}]`;this.deleteField(a)}(n?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.swapFieldValues=(t,s,n,o)=>{this.setFieldValue(t,u=>{const a=u[s],l=u[n];return q(q(u,`${s}`,l),`${n}`,a)},S(o,{dontValidate:!0})),J(this).handleArraySwap(t,s,n),(o?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.moveFieldValues=(t,s,n,o)=>{this.setFieldValue(t,u=>{const a=[...u];return a.splice(n,0,a.splice(s,1)[0]),a},S(o,{dontValidate:!0})),J(this).handleArrayMove(t,s,n),(o?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.clearFieldValues=(t,s)=>{const n=this.getFieldValue(t),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(t,[],S(s,{dontValidate:!0})),o!==null)for(let u=0;u<=o;u++){const a=`${t}[${u}]`;this.deleteField(a)}(s?.dontValidate??!1)||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[t]:ot},values:this.options.defaultValues?q(s.values,t,$(this.options.defaultValues,t)):s.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[s,n])=>(Object.keys(n).length&&n.errors.length&&(t[s]={errors:n.errors,errorMap:n.errorMap}),t),{})}),this.parseValuesWithSchema=t=>x.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>x.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=i?.formId??fe(),this._devtoolsSubmissionOverride=!1,this.baseStore=new vt(pt({...i?.defaultState,values:i?.defaultValues??i?.defaultState?.values})),this.fieldMetaDerived=new U({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const o=n,d=t?.[0],u=s[0];let a=0;const l={};for(const h of Object.keys(u.fieldMetaBase)){const c=u.fieldMetaBase[h],f=d?.fieldMetaBase[h],m=o?.[h],v=$(u.values,h);let F=m?.errors;if(!f||c.errorMap!==f.errorMap){F=Object.values(c.errorMap??{}).filter(y=>y!==void 0);const b=this.getFieldInfo(h)?.instance;b&&!b.options.disableErrorFlat&&(F=F.flat(1))}const p=!he(F),g=!c.isDirty,V=_(v,$(this.options.defaultValues,h))||_(v,this.getFieldInfo(h)?.instance?.options.defaultValue);if(m&&m.isPristine===g&&m.isValid===p&&m.isDefaultValue===V&&m.errors===F&&c===f){l[h]=m,a++;continue}l[h]={...c,errors:F??[],isPristine:g,isValid:p,isDefaultValue:V}}return Object.keys(u.fieldMetaBase).length&&o&&a===Object.keys(u.fieldMetaBase).length?o:l}}),this.store=new U({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const o=n,d=t?.[0],u=s[0],a=s[1],l=Object.values(a).filter(Boolean),h=l.some(M=>M.isValidating),c=l.every(M=>M.isValid),f=l.some(M=>M.isTouched),m=l.some(M=>M.isBlurred),v=l.every(M=>M.isDefaultValue),F=f&&u.errorMap?.onMount,p=l.some(M=>M.isDirty),g=!p,V=!!(u.errorMap?.onMount||l.some(M=>M?.errorMap?.onMount)),b=!!h;let y=o?.errors??[];(!d||u.errorMap!==d.errorMap)&&(y=Object.values(u.errorMap).reduce((M,I)=>I===void 0?M:I&&yt(I)?(M.push(I.form),M):(M.push(I),M),[]));const L=y.length===0,T=c&&L,E=this.options.canSubmitWhenInvalid??!1,D=u.submissionAttempts===0&&!f&&!V||!b&&!u.isSubmitting&&T||E;let O=u.errorMap;if(F&&(y=y.filter(M=>M!==u.errorMap.onMount),O=Object.assign(O,{onMount:void 0})),o&&d&&o.errorMap===O&&o.fieldMeta===this.fieldMetaDerived.state&&o.errors===y&&o.isFieldsValidating===h&&o.isFieldsValid===c&&o.isFormValid===L&&o.isValid===T&&o.canSubmit===D&&o.isTouched===f&&o.isBlurred===m&&o.isPristine===g&&o.isDefaultValue===v&&o.isDirty===p&&_(d,u))return o;let dt={...u,errorMap:O,fieldMeta:this.fieldMetaDerived.state,errors:y,isFieldsValidating:h,isFieldsValid:c,isFormValid:L,isValid:T,canSubmit:D,isTouched:f,isBlurred:m,isPristine:g,isDefaultValue:v,isDirty:p};const ht=this.options.transform?.deps??[];if(ht.length!==this.prevTransformArray.length||ht.some((M,I)=>M!==this.prevTransformArray[I])){const M=Object.assign({},this,{state:dt});this.options.transform?.fn(M),dt=M.state,this.prevTransformArray=ht}return dt}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(i||{});const e=ne(t=>w.emit("form-state",{id:this._formId,state:t}),{wait:300});this.store.subscribe(()=>{e(this.store.state)}),w.on("request-form-state",t=>{t.payload.id===this._formId&&w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),w.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),w.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(i){return Ut(i.validate)?x[i.type](i.value,i.validate):i.validate(i.value)}async handleSubmit(i){this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(n=>({...n,isTouched:!0})))})});const e=i??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}this.baseStore.setState(s=>({...s,isSubmitting:!0}));const t=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(s=>s.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),A(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),t()})}catch(s){throw this.baseStore.setState(n=>({...n,isSubmitSuccessful:!1})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:s}),t(),s}}setErrorMap(i){A(()=>{Object.entries(i).forEach(([e,t])=>{const s=e;if(yt(t)){const{formError:n,fieldErrors:o}=st(t);for(const d of Object.keys(this.fieldInfo))this.getFieldMeta(d)&&this.setFieldMeta(d,a=>({...a,errorMap:{...a.errorMap,[s]:o?.[d]},errorSourceMap:{...a.errorSourceMap,[s]:"form"}}));this.baseStore.setState(d=>({...d,errorMap:{...d.errorMap,[s]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[s]:t}}))})})}}function st(r){if(r){if(yt(r)){const i=st(r.form).formError,e=r.fields;return{formError:i,fieldErrors:e}}return{formError:r}}return{formError:void 0}}function W(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class ge{constructor(i){this.options={},this.mount=()=>{const e=this.store.mount();this.options.defaultValue!==void 0&&!this.getMeta().isTouched&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:s}=this.options.validators||{};if(s){const n=this.runValidator({validate:s,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});n&&this.setMeta(o=>({...o,errorMap:{...o?.errorMap,onMount:n},errorSourceMap:{...o?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),e},this.update=e=>{if(this.options=e,this.name=e.name,!this.state.meta.isTouched&&this.options.defaultValue!==void 0){const t=this.form.getFieldValue(this.name);_(t,e.defaultValue)||this.form.setFieldValue(this.name,e.defaultValue,{dontUpdateMeta:!0,dontValidate:!0,dontRunListeners:!0})}this.form.getFieldMeta(this.name)||this.form.setFieldMeta(this.name,this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(e,t)=>{this.form.setFieldValue(this.name,e,S(t,{dontRunListeners:!0,dontValidate:!0})),t?.dontRunListeners||this.triggerOnChangeListener(),t?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=e=>this.form.setFieldMeta(this.name,e),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(e,t)=>{this.form.pushFieldValue(this.name,e,S(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(e,t,s)=>{this.form.insertFieldValue(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(e,t,s)=>{this.form.replaceFieldValue(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(e,t)=>{this.form.removeFieldValue(this.name,e,S(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(e,t,s)=>{this.form.swapFieldValues(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(e,t,s)=>{this.form.moveFieldValues(this.name,e,t,S(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=e=>{this.form.clearFieldValues(this.name,S(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=e=>{const t=Object.values(this.form.fieldInfo),s=[];for(const n of t){if(!n.instance)continue;const{onChangeListenTo:o,onBlurListenTo:d}=n.instance.options.validators||{};e==="change"&&o?.includes(this.name)&&s.push(n.instance),e==="blur"&&d?.includes(this.name)&&s.push(n.instance)}return s},this.validateSync=(e,t)=>{const s=Mt(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),o=this.getLinkedFields(e).reduce((a,l)=>{const h=Mt(e,{...l.options,form:l.form,validationLogic:l.form.options.validationLogic||P});return h.forEach(c=>{c.field=l}),a.concat(h)},[]);let d=!1;A(()=>{const a=(l,h)=>{const c=Q(h.cause),f=h.validate?Ct(l.runValidator({validate:h.validate,value:{value:l.store.state.value,validationSource:"field",fieldApi:l},type:"validate"})):void 0,m=t[c],{newErrorValue:v,newSource:F}=kt({formLevelError:m,fieldLevelError:f});l.state.meta.errorMap?.[c]!==v&&l.setMeta(p=>({...p,errorMap:{...p.errorMap,[c]:v},errorSourceMap:{...p.errorSourceMap,[c]:F}})),v&&(d=!0)};for(const l of s)a(this,l);for(const l of o)l.validate&&a(l.field,l)});const u=Q("submit");return this.state.meta.errorMap?.[u]&&e!=="submit"&&!d&&this.setMeta(a=>({...a,errorMap:{...a.errorMap,[u]:void 0},errorSourceMap:{...a.errorSourceMap,[u]:void 0}})),{hasErrored:d}},this.validateAsync=async(e,t)=>{const s=Vt(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),n=await t,o=this.getLinkedFields(e),d=o.reduce((c,f)=>{const m=Vt(e,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||P});return m.forEach(v=>{v.field=f}),c.concat(m)},[]);this.state.meta.isValidating||this.setMeta(c=>({...c,isValidating:!0}));for(const c of o)c.setMeta(f=>({...f,isValidating:!0}));const u=[],a=[],l=(c,f,m)=>{const v=Q(f.cause);c.getInfo().validationMetaMap[v]?.lastAbortController.abort();const p=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:p},m.push(new Promise(async g=>{let V;try{V=await new Promise((E,D)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(p.signal.aborted)return E(void 0);try{E(await this.runValidator({validate:f.validate,value:{value:c.store.state.value,fieldApi:c,signal:p.signal,validationSource:"field"},type:"validateAsync"}))}catch(O){D(O)}},f.debounceMs)})}catch(E){V=E}if(p.signal.aborted)return g(void 0);const b=Ct(V),y=n[this.name]?.[v],{newErrorValue:L,newSource:T}=kt({formLevelError:y,fieldLevelError:b});c.setMeta(E=>({...E,errorMap:{...E?.errorMap,[v]:L},errorSourceMap:{...E.errorSourceMap,[v]:T}})),g(L)}))};for(const c of s)c.validate&&l(this,c,u);for(const c of d)c.validate&&l(c.field,c,a);let h=[];(u.length||a.length)&&(h=await Promise.all(u),await Promise.all(a)),this.setMeta(c=>({...c,isValidating:!1}));for(const c of o)c.setMeta(f=>({...f,isValidating:!1}));return h.filter(Boolean)},this.validate=(e,t)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=t?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(e),{hasErrored:n}=this.validateSync(e,s[this.name]??{});if(n&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[Q(e)]?.lastAbortController.abort(),this.state.meta.errors;const o=t?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(e);return this.validateAsync(e,o)},this.handleChange=e=>{this.setValue(e)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=e=>x.validate({value:this.state.value,validationSource:"field"},e),this.parseValueWithSchemaAsync=e=>x.validateAsync({value:this.state.value,validationSource:"field"},e),this.form=i.form,this.name=i.name,this.options=i,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new U({deps:[this.form.store],fn:()=>{const e=this.form.getFieldMeta(this.name)??{...ot,...i.defaultMeta};let t=this.form.getFieldValue(this.name);return!e.isTouched&&t===void 0&&this.options.defaultValue!==void 0&&!_(t,this.options.defaultValue)&&(t=this.options.defaultValue),{value:t,meta:e}}})}get state(){return this.store.state}runValidator(i){return Ut(i.validate)?x[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(e=>({...e,errorMap:{...e.errorMap,...i}}))}triggerOnBlurListener(){const i=this.form.options.listeners?.onBlurDebounceMs;i&&i>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},i)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}triggerOnChangeListener(){const i=this.form.options.listeners?.onChangeDebounceMs;i&&i>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},i)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})}}function Ct(r){if(r)return r}function Q(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class at{constructor(i){if(this.getFormFieldName=e=>{if(typeof this.fieldsMap=="string")return Dt(this.fieldsMap,e);const t=ct(e)[0];if(typeof t!="string")return"";const s=e.slice(t.length),n=this.fieldsMap[t];return Dt(n,s)},this.getFormFieldOptions=e=>{const t={...e},s=t.validators;if(t.name=this.getFormFieldName(e.name),s&&(s.onChangeListenTo||s.onBlurListenTo)){const n={...s},o=d=>{if(d)return d.map(u=>this.getFormFieldName(u))};n.onChangeListenTo=o(s.onChangeListenTo),n.onBlurListenTo=o(s.onBlurListenTo),t.validators=n}return t},this.mount=()=>this.store.mount(),this.validateArrayFieldsStartingFrom=async(e,t,s)=>this.form.validateArrayFieldsStartingFrom(this.getFormFieldName(e),t,s),this.validateField=(e,t)=>this.form.validateField(this.getFormFieldName(e),t),this.getFieldValue=e=>this.form.getFieldValue(this.getFormFieldName(e)),this.getFieldMeta=e=>this.form.getFieldMeta(this.getFormFieldName(e)),this.setFieldMeta=(e,t)=>this.form.setFieldMeta(this.getFormFieldName(e),t),this.setFieldValue=(e,t,s)=>this.form.setFieldValue(this.getFormFieldName(e),t,s),this.deleteField=e=>this.form.deleteField(this.getFormFieldName(e)),this.pushFieldValue=(e,t,s)=>this.form.pushFieldValue(this.getFormFieldName(e),t,s),this.insertFieldValue=async(e,t,s,n)=>this.form.insertFieldValue(this.getFormFieldName(e),t,s,n),this.replaceFieldValue=async(e,t,s,n)=>this.form.replaceFieldValue(this.getFormFieldName(e),t,s,n),this.removeFieldValue=async(e,t,s)=>this.form.removeFieldValue(this.getFormFieldName(e),t,s),this.swapFieldValues=(e,t,s,n)=>this.form.swapFieldValues(this.getFormFieldName(e),t,s,n),this.moveFieldValues=(e,t,s,n)=>this.form.moveFieldValues(this.getFormFieldName(e),t,s,n),this.clearFieldValues=(e,t)=>this.form.clearFieldValues(this.getFormFieldName(e),t),this.resetField=e=>this.form.resetField(this.getFormFieldName(e)),this.validateAllFields=e=>this.form.validateAllFields(e),i.form instanceof at){const e=i.form;if(this.form=e.form,typeof i.fields=="string")this.fieldsMap=e.getFormFieldName(i.fields);else{const t={...i.fields};for(const s in t)t[s]=e.getFormFieldName(t[s]);this.fieldsMap=t}}else this.form=i.form,this.fieldsMap=i.fields;this.store=new U({deps:[this.form.store],fn:({currDepVals:e})=>{const t=e[0];let s;if(typeof this.fieldsMap=="string")s=$(t.values,this.fieldsMap);else{s={};const n=this.fieldsMap;for(const o in n)s[o]=$(t.values,n[o])}return{values:s}}})}get state(){return this.store.state}async handleSubmit(i){return this.form.handleSubmit(i)}}function bt(r,i=e=>e){const[e,t]=Ot(i(r.state)),s=r.subscribe(()=>{const n=i(r.state);Fe(e(),n)||t(()=>n)});return lt(()=>{s()}),e}function Fe(r,i){if(Object.is(r,i))return!0;if(typeof r!="object"||r===null||typeof i!="object"||i===null)return!1;if(r instanceof Map&&i instanceof Map){if(r.size!==i.size)return!1;for(const[t,s]of r)if(!i.has(t)||!Object.is(s,i.get(t)))return!1;return!0}if(r instanceof Set&&i instanceof Set){if(r.size!==i.size)return!1;for(const t of r)if(!i.has(t))return!1;return!0}if(r instanceof Date&&i instanceof Date)return r.getTime()===i.getTime();const e=Object.keys(r);if(e.length!==Object.keys(i).length)return!1;for(let t=0;t<e.length;t++)if(!Object.prototype.hasOwnProperty.call(i,e[t])||!Object.is(r[e[t]],i[e[t]]))return!1;return!0}function Me(r){const[i,e]=Ot(r,{equals:!1}),t=r.store.subscribe(()=>e(r));return lt(t),i}function Wt(r){const i=r(),e=new ge(i),t=e;t.Field=Gt;let s=!1;return St(()=>{const n=e.mount();s=!0,lt(()=>{n(),s=!1})}),$t(()=>{s&&e.update(r())}),Me(t)}function Gt(r){const i=Wt(()=>{const{children:e,...t}=r;return t});return zt(()=>k(()=>r.children(i),{}))}function Ve(r){const i=r?.(),e=new ve(i),t=e;return t.Field=s=>k(Gt,it(s,{form:e})),t.createField=s=>Wt(()=>({...s(),form:e})),t.useStore=s=>bt(e.store,s),t.Subscribe=s=>ut(s.children,bt(e.store,s.selector)),St(e.mount),$t(()=>e.update(r?.())),t}function ye(r){const i=r(),e=new at(i),t=i.form instanceof at?i.form.form:i.form,s=e;return s.AppForm=n=>k(t.AppForm,n),s.AppField=n=>k(t.AppField,it(()=>e.getFormFieldOptions(n))),s.Field=n=>k(t.Field,it(()=>e.getFormFieldOptions(n))),s.Subscribe=n=>{const o=bt(e.store,n.selector);return ut(n.children,o())},St(()=>{const n=e.mount();lt(()=>{n()})}),Object.assign(s,{...i.formComponents})}function we(){const r=Et(null);function i(){const s=wt(r);if(!s)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return s}const e=Et(null);function t(){const s=wt(e);if(!s)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return s}return{fieldContext:r,useFieldContext:i,useFormContext:t,formContext:e}}function Ae(r){function i(s){const n=Ve(s),o=a=>k(r.formContext.Provider,{value:n,get children(){return a.children}}),d=a=>{const[l,h]=Kt(a,["children"]);return k(n.Field,it(h,{children:c=>k(r.fieldContext.Provider,{value:c,get children(){return l.children(Object.assign(c,r.fieldComponents))}})}))},u=n;u.AppField=d,u.AppForm=o;for(const[a,l]of Object.entries(r.formComponents))u[a]=l;return u}function e({render:s,props:n}){return o=>s({...n,...o})}function t({render:s,props:n,defaultValues:o}){return function(u){const a={form:u.form,fields:u.fields,defaultValues:o,formComponents:r.formComponents},l=ye(()=>a);return s({...n,...u,group:l})}}return{useAppForm:i,withForm:e,withFieldGroup:t}}export{Ae as a,we as c};
