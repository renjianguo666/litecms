import{z as ue,d as D,a0 as B,A as n,C as t,b as e,S as x,F as G,m as ge,e as p,k as J,U as R}from"./vendor-ui-EoCh-MHn.js";import{E as A,n as he,B as c,D as L,T as me,e as fe,g as xe,f as pe,h as V,i as W,j as X,k as be,l as Y,m as Z,q as I,Q as ve,R as $e,S as ee,t as C,p as _e,A as te,U as Ce,d as re,C as le,a as ne,b as se,c as we}from"./main-DH-8hjXZ.js";import{B as ye}from"./badge-DHoF6Ywq.js";import{p as Se,t as ze}from"./trash-2-DTqUw5ZB.js";import"./vendor-form-BYywqLDt.js";import"./vendor-editor-B9FEBeCH.js";var ke=n('<div class="rounded-lg border border-border overflow-hidden"><table class="w-full text-sm"><thead><tr class="border-b border-border bg-muted/50"><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground">标题</th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-20">操作</th></tr></thead><tbody>'),De=n('<div class="relative mb-4">'),Ae=n('<table class="w-full text-sm"><thead><tr class="border-b border-border bg-muted/50"><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-8"></th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground">标题</th><th class="h-10 px-4 text-left align-middle font-semibold text-muted-foreground w-24">状态</th></tr></thead><tbody>'),Ie=n('<div class="min-h-[300px] max-h-[400px] overflow-y-auto border border-border rounded-lg">'),Te=n('<div class="text-sm text-muted-foreground">已选择 <!> 篇文章'),je=n('<div class=space-y-4><div class="flex items-center justify-between"><div class="text-sm text-muted-foreground">共 <!> 篇文章'),Fe=n('<div class="flex justify-center py-8">'),Re=n('<div class="text-center py-12 text-muted-foreground"><p class="text-lg mb-2">暂无文章</p><p class=text-sm>点击「添加文章」将文章加入此推荐位'),Be=n('<tr><td class="h-12 px-4 align-middle"><span class=font-medium></span></td><td class="h-12 px-4 align-middle">'),Ee=n('<div class="flex items-center justify-center h-[300px] text-muted-foreground">请输入关键词搜索文章'),Me=n('<div class="flex items-center justify-center h-[300px]">'),Pe=n('<div class="flex items-center justify-center h-[300px] text-muted-foreground">未找到相关文章'),He=n('<tr><td class="h-12 px-4 align-middle"></td><td class="h-12 px-4 align-middle"><span class=font-medium></span></td><td class="h-12 px-4 align-middle"><span>');function Ke(u){const[g,h]=D(!1),[v,o]=D(""),[s,w]=D(new Set),[E,M]=D(!1),[y,{refetch:P}]=B(()=>u.featureId,r=>A.listContents(r)),[$]=B(()=>g()?v():null,async r=>!r||r.length<2?null:(await he.list({search:r,page_size:20})).items),ae=async r=>{try{await A.removeContent(u.featureId,r),C.success("移除成功"),P()}catch{C.error("移除失败")}},H=r=>{const a=new Set(s());a.has(r)?a.delete(r):a.add(r),w(a)},ie=r=>{w(r?new Set($()?.map(a=>a.id)??[]):new Set)},de=async()=>{const r=Array.from(s());if(r.length===0){C.error("请选择要添加的文章");return}M(!0);try{const a=await A.addContents(u.featureId,r);C.success(`成功添加 ${a.added} 篇文章`),K(),P()}catch{C.error("添加失败")}finally{M(!1)}},K=()=>{h(!1),w(new Set),o("")};return(()=>{var r=je(),a=r.firstChild,U=a.firstChild,oe=U.firstChild,q=oe.nextSibling;return q.nextSibling,t(U,()=>y()?.contents?.length??0,q),t(a,e(c,{size:"sm",onClick:()=>h(!0),get children(){return[e(Se,{class:"size-4"}),"添加文章"]}}),null),t(r,e(x,{get when(){return!y.loading},get fallback(){return(()=>{var l=Fe();return t(l,e(I,{class:"size-6 animate-spin text-primary"})),l})()},get children(){return e(x,{get when(){return y()?.contents?.length},get fallback(){return Re()},get children(){var l=ke(),d=l.firstChild,m=d.firstChild,T=m.nextSibling;return t(T,e(G,{get each(){return y()?.contents},children:(_,j)=>(()=>{var i=Be(),S=i.firstChild,b=S.firstChild,z=S.nextSibling;return t(b,()=>_.title),t(z,e(L,{get children(){return[e(me,{get children(){return[e(fe,{as:k=>e(xe,{as:F=>e(c,ge({variant:"ghost",size:"icon-sm",class:"text-destructive hover:text-destructive hover:bg-destructive/10"},k,F,{get children(){return e(ze,{class:"size-3.5"})}}))})}),e(pe,{children:"移除"})]}}),e(V,{get children(){return[e(W,{get children(){return[e(X,{children:"移除文章"}),e(be,{get children(){return["确定要从推荐位中移除「",p(()=>_.title),"」吗？"]}})]}}),e(Y,{get children(){return[e(Z,{as:c,variant:"outline",children:"取消"}),e(Z,{as:c,variant:"destructive",onClick:()=>ae(_.content_id),children:"确认移除"})]}})]}})]}})),J(()=>R(i,`border-b border-border transition-colors hover:bg-muted/50 ${j()%2===1?"bg-muted/30":""}`)),i})()})),l}})}}),null),t(r,e(L,{get open(){return g()},onOpenChange:h,get children(){return e(V,{class:"max-w-2xl",get children(){return[e(W,{get children(){return e(X,{children:"添加文章到推荐位"})}}),(()=>{var l=De();return t(l,e(ve,{class:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground pointer-events-none"}),null),t(l,e($e,{type:"text",placeholder:"输入关键词搜索文章（至少2个字符）",class:"pl-10",get value(){return v()},onInput:d=>o(d.currentTarget.value)}),null),l})(),(()=>{var l=Ie();return t(l,e(x,{get when(){return v().length>=2},get fallback(){return Ee()},get children(){return e(x,{get when(){return!$.loading},get fallback(){return(()=>{var d=Me();return t(d,e(I,{class:"size-6 animate-spin text-primary"})),d})()},get children(){return e(x,{get when(){return $()?.length},get fallback(){return Pe()},get children(){var d=Ae(),m=d.firstChild,T=m.firstChild,_=T.firstChild,j=m.nextSibling;return t(_,e(ee,{get checked(){return p(()=>$()?.length===s().size)()&&s().size>0},onChange:ie})),t(j,e(G,{get each(){return $()},children:(i,S)=>(()=>{var b=He(),z=b.firstChild,k=z.nextSibling,F=k.firstChild,ce=k.nextSibling,N=ce.firstChild;return b.$$click=()=>H(i.id),t(z,e(ee,{get checked(){return s().has(i.id)},onChange:()=>H(i.id)})),t(F,()=>i.title),t(N,(()=>{var f=p(()=>i.status==="published");return()=>f()?"已发布":i.status==="draft"?"草稿":"已归档"})()),J(f=>{var O=`border-b border-border transition-colors hover:bg-muted/50 cursor-pointer ${S()%2===1?"bg-muted/30":""}`,Q=`inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-md border ${i.status==="published"?"bg-green-500/10 text-green-600 border-green-500/20 dark:text-green-400":i.status==="draft"?"bg-yellow-500/10 text-yellow-600 border-yellow-500/20 dark:text-yellow-400":"bg-muted text-muted-foreground border-border"}`;return O!==f.e&&R(b,f.e=O),Q!==f.t&&R(N,f.t=Q),f},{e:void 0,t:void 0}),b})()})),d}})}})}})),l})(),e(x,{get when(){return s().size>0},get children(){var l=Te(),d=l.firstChild,m=d.nextSibling;return m.nextSibling,t(l,()=>s().size,m),l}}),e(Y,{get children(){return[e(c,{variant:"outline",onClick:K,children:"取消"}),e(c,{get disabled(){return s().size===0||E()},onClick:de,get children(){return[p(()=>p(()=>!!E())()&&e(I,{class:"size-4 animate-spin"})),"添加 ",p(()=>s().size)," 篇文章"]}})]}})]}})}}),null),r})()}ue(["click"]);var Ue=n('<div class="flex items-start justify-between"><div class=space-y-1>'),qe=n('<div class="mx-auto max-w-4xl space-y-6"><div>'),Ne=n('<div class="flex min-h-[400px] items-center justify-center">');function We(){const u=_e(),[g]=B(()=>u.id,A.get);return(()=>{var h=qe(),v=h.firstChild;return t(v,e(c,{as:te,href:"/features",variant:"ghost",size:"sm",get children(){return[e(Ce,{class:"mr-2 h-4 w-4"}),"返回推荐位列表"]}})),t(h,e(x,{get when(){return p(()=>!g.loading)()&&g()},get fallback(){return(()=>{var o=Ne();return t(o,e(I,{class:"h-8 w-8 animate-spin text-muted-foreground"})),o})()},get children(){return[e(re,{get children(){return e(le,{get children(){var o=Ue(),s=o.firstChild;return t(s,e(ne,{get children(){return g().name}}),null),t(s,e(se,{get children(){return e(ye,{variant:"secondary",class:"font-mono text-xs",get children(){return g().id}})}}),null),t(o,e(c,{as:te,get href(){return`/features/${u.id}`},variant:"outline",size:"sm",children:"编辑推荐位"}),null),o}})}}),e(re,{get children(){return[e(le,{get children(){return[e(ne,{children:"内容管理"}),e(se,{children:"管理与此推荐位关联的内容"})]}}),e(we,{get children(){return e(Ke,{get featureId(){return u.id}})}})]}})]}}),null),h})()}export{We as default};
