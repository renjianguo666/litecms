import{z as le,s as ne,h as W,A as m,C as r,b as t,k as z,U as S,S as f,Q as ae,F as Z,V as B,e as K,d as re,a0 as H}from"./vendor-ui-EoCh-MHn.js";import{r as C,s as ie,v as oe,w as de,x as ce,y as ue,z as he,E as ge,F as me,G as pe,H as fe,q as ve,J as be}from"./main-Nj9AaWuF.js";import{f as xe,T as _e}from"./tree-list-BoGU-KXw.js";import{c as $e}from"./chevron-right-BdL49Itd.js";import{r as we}from"./rotate-ccw-NaPc1X8M.js";import{s as ye}from"./save-DunlAXZV.js";var Se=m("<button type=button>清空"),Ce=m('<div class="mt-1.5 flex flex-wrap gap-1">'),ke=m('<div class="mt-1 text-xs text-muted-foreground">未选择'),Fe=m('<div data-slot=tree-list-multi><div class="px-3 py-2 border-b bg-muted/50 shrink-0"><div class="flex items-center justify-between"><span class="text-sm font-medium"></span><div class="flex gap-1"><button type=button>全部</button></div></div></div><div class="flex-1 overflow-y-auto py-1 min-h-0">'),Le=m('<span class="inline-flex items-center px-2 py-0.5 text-xs font-medium rounded bg-primary text-primary-foreground">'),ze=m('<div class="py-8 text-center text-sm text-muted-foreground">'),Ee=m("<button type=button>"),Te=m("<span>"),Ie=m('<span class="text-xs text-muted-foreground/60 mr-2">(当前)'),Ae=m('<div><div class="flex h-full shrink-0"><div class="relative h-full"style=width:18px><div class="absolute top-0"style=left:9px></div><div class=absolute style=left:9px;top:50%;width:9px></div></div></div><div></div><span>'),Ne=m('<div class="absolute top-0 h-full"style=left:9px>'),Pe=m('<div class="relative h-full"style=width:18px>'),Ve=m('<span class="w-4 shrink-0">');function je(x,o){const k=()=>o?.(),_=W(()=>{const e=x();return e.map((s,i)=>{const c=e[i+1],h=c?c.depth>s.depth:!1;return{...s,has_children:h}})}),E=()=>new Set(_().filter(e=>e.has_children).map(e=>e.id)),[F,y]=re(E()),[d,T]=re(!0),I=()=>{d()?(y(new Set),T(!1)):(y(E()),T(!0))},j=(e,s)=>{s.stopPropagation();const i=new Set(F());i.has(e)?i.delete(e):i.add(e),y(i)},A=e=>{const s=_(),i=s[e];if(i.depth===0)return!0;let c=i.depth-1;for(let h=e-1;h>=0&&c>=0;h--){const g=s[h];if(g.depth===c){if(!F().has(g.id))return!1;c--}}return!0},N=(e,s)=>{const i=_();for(let c=e+1;c<i.length;c++){if(i[c].depth===s)return!1;if(i[c].depth<s)return!0}return!0};return{processedNodes:_,expanded:F,allExpanded:d,toggleAll:I,toggleExpand:j,isVisible:A,isLastInLevel:N,getTreeLines:e=>{const s=_(),i=s[e],c=[];for(let h=0;h<i.depth;h++){let g=-1;for(let $=e-1;$>=0;$--)if(s[$].depth===h){g=$;break}if(g===-1){c.push(!1);continue}c.push(!N(g,h))}return c},isDisabled:e=>e===k()}}function De(x){const[o]=ne(x,["nodes","value","onChange","class","title","placeholder","disabledId","showIcon"]),{processedNodes:k,expanded:_,allExpanded:E,toggleAll:F,toggleExpand:y,isVisible:d,isLastInLevel:T,getTreeLines:I,isDisabled:j}=je(()=>o.nodes,()=>o.disabledId),A=W(()=>new Set(o.value)),N=e=>{const s=new Set(o.value);s.has(e)?s.delete(e):s.add(e),o.onChange(Array.from(s))},l=()=>{o.onChange([])},u=W(()=>{const e=[],s=A();for(const i of o.nodes)s.has(i.id)&&e.push(i.name);return e});return(()=>{var e=Fe(),s=e.firstChild,i=s.firstChild,c=i.firstChild,h=c.nextSibling,g=h.firstChild,$=g.firstChild,q=s.nextSibling;return r(c,()=>o.title??"选择节点"),r(h,t(f,{get when(){return o.value.length>0},get children(){var n=Se();return n.$$click=l,z(()=>S(n,C("inline-flex items-center px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors"))),n}}),g),ae(g,"click",F,!0),r(g,()=>E()?"收起":"展开",$),r(s,t(f,{get when(){return o.value.length>0},get children(){var n=Ce();return r(n,t(Z,{get each(){return u()},children:v=>(()=>{var p=Le();return r(p,v),p})()})),n}}),null),r(s,t(f,{get when(){return o.value.length===0},get children(){return ke()}}),null),r(q,t(f,{get when(){return k().length>0},get fallback(){return(()=>{var n=ze();return r(n,()=>o.placeholder??"暂无数据"),n})()},get children(){return t(Z,{get each(){return k()},children:(n,v)=>{const p=()=>j(n.id),b=()=>A().has(n.id),U=()=>T(v(),n.depth),M=()=>I(v()),R=()=>_().has(n.id),P=()=>b()?"1px solid hsl(var(--primary-foreground) / 0.6)":"1px solid hsl(var(--muted-foreground) / 0.3)";return t(f,{get when(){return d(v())},get children(){var w=Ae(),V=w.firstChild,X=V.firstChild,G=X.firstChild,se=G.nextSibling,O=V.nextSibling,J=O.nextSibling;return w.$$click=()=>!p()&&N(n.id),r(V,t(Z,{get each(){return M()},children:a=>(()=>{var L=Pe();return r(L,t(f,{when:a,get children(){var D=Ne();return z(Q=>B(D,"border-left",P())),D}})),L})()}),X),r(w,t(f,{get when(){return n.has_children},get fallback(){return Ve()},get children(){var a=Ee();return a.$$click=L=>y(n.id,L),r(a,t(f,{get when(){return R()},get fallback(){return t($e,{class:"size-3.5"})},get children(){return t(ie,{class:"size-3.5"})}})),z(()=>S(a,C("w-4 h-4 flex items-center justify-center shrink-0 rounded","transition-transform duration-200",b()?"text-primary-foreground/80 hover:text-primary-foreground":"text-muted-foreground hover:text-foreground"))),a}}),O),r(O,t(f,{get when(){return b()},get children(){return t(oe,{class:"size-3"})}})),r(w,t(f,{get when(){return o.showIcon!==!1},get children(){var a=Te();return r(a,t(f,{get when(){return K(()=>!!n.has_children)()&&R()},get fallback(){return t(xe,{class:"size-4"})},get children(){return t(de,{class:"size-4"})}})),z(()=>S(a,C("ml-1 shrink-0",b()?"text-primary-foreground/80":"text-amber-500 dark:text-amber-400"))),a}}),J),r(J,()=>n.name),r(w,t(f,{get when(){return p()},get children(){return Ie()}}),null),z(a=>{var L=C("group flex items-center h-7 mx-1 select-none rounded-sm","transition-colors duration-150",p()&&"opacity-50 cursor-not-allowed",!p()&&b()&&"bg-primary text-primary-foreground cursor-pointer",!p()&&!b()&&"hover:bg-accent hover:text-accent-foreground cursor-pointer"),D=U()?"50%":"100%",Q=P(),Y=P(),ee=C("w-4 h-4 flex items-center justify-center shrink-0 rounded border",b()?"bg-primary-foreground/20 border-primary-foreground/40":"border-muted-foreground/30 group-hover:border-muted-foreground/50"),te=C("text-sm ml-1.5 truncate pr-2",b()&&"font-medium");return L!==a.e&&S(w,a.e=L),D!==a.t&&B(G,"height",a.t=D),Q!==a.a&&B(G,"border-left",a.a=Q),Y!==a.o&&B(se,"border-top",a.o=Y),ee!==a.i&&S(O,a.i=ee),te!==a.n&&S(J,a.n=te),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),w}})}})}})),z(n=>{var v=C("flex flex-col rounded-lg border bg-card text-card-foreground overflow-hidden",o.class),p=C("inline-flex items-center gap-1 px-1.5 py-0.5 text-xs rounded","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","transition-colors");return v!==n.e&&S(e,n.e=v),p!==n.t&&S(g,n.t=p),n},{e:void 0,t:void 0}),e})()}le(["click"]);var Ue=m('<div class="lg:mr-68 space-y-4"><div class="bg-card rounded-lg border border-border shadow-sm"><div class="p-5 space-y-4"></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">摘要与封面</h2><div class="grid grid-cols-1 gap-4"><div class="grid grid-cols-2 gap-4"></div></div></div></div><div class="bg-card rounded-lg border border-border shadow-sm"><div class=p-5><h2 class="text-base font-semibold mb-4">推送至</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div></div><div class="flex items-center justify-between pt-2"><div class="flex gap-3">'),Me=m('<aside class="hidden lg:block fixed right-6.5 top-20 bottom-4 w-64">'),Re=m('<div class="flex items-center gap-2"><label class="text-sm font-medium whitespace-nowrap">发布时间</label><input type=datetime-local class="h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">'),Oe=m('<div class="h-full border border-border rounded-lg bg-card flex items-center justify-center">');function Qe(x){const o=Math.random().toString(36).slice(2)+Date.now().toString(36),[k]=H(async()=>(await ce.list({page_size:100})).items??[]),[_]=H(async()=>(await ue.list({page_size:100})).items??[]),[E]=H(async()=>(await he.list({page_size:100})).items??[]),[F]=H(async()=>(await ge.list({page_size:100})).items??[]),y=x.mode==="create"?me:pe,d=fe(()=>({defaultValues:x.defaultValues,validators:{onMount:y,onChange:y},onSubmit:async({value:l})=>{x.mode==="create"?await x.onSubmit({...l,upload_token:o}):await x.onSubmit({...l,upload_token:o})}})),T=async l=>(await be.upload(l,o)).url,I=W(()=>{const l=k()??[];if(l.length===0)return[];const u=new Set(l.map(e=>e.parent_id).filter(e=>e!==null));return l.map(e=>({id:e.id,name:e.name,parent_id:e.parent_id??null,depth:e.depth,has_children:u.has(e.id)}))}),j=()=>(_()??[]).map(l=>({label:l.name,value:l.id})),A=()=>(E()??[]).map(l=>({label:l.name,value:l.id})),N=()=>(F()??[]).map(l=>({label:l.name,value:l.id}));return t(d.Form,{class:"relative",get children(){return[(()=>{var l=Ue(),u=l.firstChild,e=u.firstChild,s=u.nextSibling,i=s.firstChild,c=i.firstChild,h=c.nextSibling,g=h.firstChild,$=s.nextSibling,q=$.firstChild,n=q.firstChild,v=n.nextSibling,p=$.nextSibling,b=p.firstChild;return r(e,t(d.StringField,{name:"title",placeholder:"请输入文章标题"}),null),r(e,t(d.EditorField,{name:"text",label:"文章内容",placeholder:"请输入文章内容...",minHeight:"400px",showWordCount:!0,onImageUpload:T}),null),r(h,t(d.TextareaField,{name:"description",label:"文章描述",placeholder:"简短描述文章内容（可选）",rows:3}),g),r(h,t(d.StringField,{name:"cover_url",label:"封面图片",placeholder:"请输入封面图片URL（可选）"}),g),r(g,t(d.StringField,{name:"source",label:"来源",placeholder:"文章来源（可选）"}),null),r(g,t(d.StringField,{name:"author",label:"作者",placeholder:"作者名称（可选）"}),null),r(v,t(d.ComboboxField,{name:"tag_ids",label:"标签",get options(){return j()},placeholder:"选择标签...",searchPlaceholder:"搜索标签..."}),null),r(v,t(d.ComboboxField,{name:"special_ids",label:"专题",get options(){return A()},placeholder:"选择专题...",searchPlaceholder:"搜索专题..."}),null),r(v,t(d.ComboboxField,{name:"feature_ids",label:"推荐位",get options(){return N()},placeholder:"选择推荐位...",searchPlaceholder:"搜索推荐位..."}),null),r(p,t(d.AppField,{name:"published_at",children:U=>(()=>{var M=Re(),R=M.firstChild,P=R.nextSibling;return P.$$input=w=>{const V=w.currentTarget.value;U().handleChange(V?`${V}:00Z`:null)},z(()=>P.value=U().state.value?.slice(0,16)??""),M})()}),b),r(b,t(d.ResetButton,{class:"gap-2",get children(){return[t(we,{class:"size-4"}),"重置"]}}),null),r(b,t(d.SubmitButton,{class:"gap-2",get children(){return[t(ye,{class:"size-4"}),K(()=>x.submitText??"发布文章")]}}),null),l})(),(()=>{var l=Me();return r(l,t(f,{get when(){return!k.loading},get fallback(){return(()=>{var u=Oe();return r(u,t(ve,{class:"size-6 animate-spin text-muted-foreground"})),u})()},get children(){return K(()=>x.mode==="create")()?t(d.AppField,{name:"category_ids",mode:"array",children:u=>t(De,{get nodes(){return I()},get value(){return u().state.value??[]},onChange:e=>u().handleChange(e),title:"选择栏目",class:"h-full shadow-sm"})}):t(d.AppField,{name:"category_id",children:u=>t(_e,{get nodes(){return I()},get value(){return u().state.value??""},onChange:e=>u().handleChange(e),title:"选择栏目",class:"h-full shadow-sm",allowEmpty:!1})})}})),l})()]}})}le(["input"]);export{Qe as A};
